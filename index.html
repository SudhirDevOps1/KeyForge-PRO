<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KeyForge Pro v3.0 ‚Äî Encrypted Password Generator & Vault by SudhirDevOps1</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="author" content="Sudhir Kumar (SudhirDevOps1)">
    <meta name="description" content="KeyForge Pro v3.0 ‚Äî AES-256-GCM encrypted password generator, passphrase builder & vault with master key. Built by Sudhir Kumar.">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        :root {
            --bg-primary: #06060c;
            --bg-secondary: #0e0e18;
            --bg-card: #161625;
            --bg-card-hover: #1e1e32;
            --bg-input: #0a0a14;
            --accent: #7c6cff;
            --accent-light: #9d90ff;
            --accent-dark: #5a4ed4;
            --text-primary: #eaeaf4;
            --text-secondary: #8888a8;
            --text-muted: #55556e;
            --border: #252540;
            --border-light: #303050;
            --success: #22c55e;
            --success-dim: rgba(34,197,94,0.15);
            --warning: #f59e0b;
            --warning-dim: rgba(245,158,11,0.15);
            --danger: #ef4444;
            --danger-dim: rgba(239,68,68,0.15);
            --info: #3b82f6;
            --info-dim: rgba(59,130,246,0.15);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(22,22,37,0.9), rgba(14,14,24,0.95));
            border: 1px solid var(--border);
            backdrop-filter: blur(24px);
        }

        .glass-card-2 {
            background: linear-gradient(145deg, rgba(30,30,50,0.7), rgba(20,20,35,0.8));
            border: 1px solid var(--border);
        }

        .glow-border {
            border: 1px solid rgba(124,108,255,0.35);
            box-shadow: 0 0 30px rgba(124,108,255,0.08), inset 0 0 30px rgba(124,108,255,0.03);
        }

        .glow-border-success {
            border: 1px solid rgba(34,197,94,0.35);
            box-shadow: 0 0 30px rgba(34,197,94,0.08);
        }

        .glow-border-warning {
            border: 1px solid rgba(245,158,11,0.35);
            box-shadow: 0 0 30px rgba(245,158,11,0.08);
        }

        .password-display {
            background: linear-gradient(145deg, #080814, #12122a);
            border: 1px solid var(--border);
            letter-spacing: 1.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--accent-light), var(--accent));
            transform: translateY(-1px);
            box-shadow: 0 8px 30px rgba(124,108,255,0.35);
        }
        .btn-primary:active { transform: translateY(0); }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            transform: translateY(-1px);
            box-shadow: 0 8px 30px rgba(34,197,94,0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transition: all 0.3s ease;
        }
        .btn-warning:hover {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            transform: translateY(-1px);
            box-shadow: 0 8px 30px rgba(245,158,11,0.3);
        }

        .btn-outline {
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        .btn-outline:hover {
            border-color: var(--accent);
            background: rgba(124,108,255,0.08);
        }

        .btn-ghost {
            transition: all 0.2s ease;
        }
        .btn-ghost:hover {
            background: rgba(124,108,255,0.1);
        }

        .input-dark {
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-primary);
            transition: all 0.3s;
        }
        .input-dark:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(124,108,255,0.12);
        }
        .input-dark::placeholder { color: var(--text-muted); }

        .strength-bar { transition: width 0.5s ease, background 0.5s ease; }

        .vault-item {
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }
        .vault-item:hover {
            border-color: rgba(124,108,255,0.4);
            background: var(--bg-card-hover);
            transform: translateX(4px);
        }

        .tab-btn {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary);
        }
        .tab-btn:hover { color: var(--text-primary); }
        .tab-btn.active {
            border-bottom-color: var(--accent);
            color: var(--accent-light);
        }

        .modal-overlay {
            background: rgba(0,0,0,0.75);
            backdrop-filter: blur(10px);
        }

        .fade-in { animation: fadeIn 0.4s ease; }
        .slide-up { animation: slideUp 0.5s ease; }
        .scale-in { animation: scaleIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes lockPulse { 0%,100%{box-shadow:0 0 0 0 rgba(245,158,11,0.4)} 50%{box-shadow:0 0 0 12px rgba(245,158,11,0)} }
        @keyframes shieldGlow { 0%,100%{filter:drop-shadow(0 0 4px rgba(34,197,94,0.5))} 50%{filter:drop-shadow(0 0 12px rgba(34,197,94,0.8))} }

        .hero-gradient {
            background: radial-gradient(ellipse at top, rgba(124,108,255,0.12) 0%, transparent 65%);
        }

        .toast {
            animation: toastIn 0.4s ease, toastOut 0.4s ease 2.6s forwards;
        }
        @keyframes toastIn { from { opacity: 0; transform: translateX(40px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes toastOut { from { opacity: 1; } to { opacity: 0; transform: translateX(40px); } }

        .symbol-btn {
            transition: all 0.2s;
        }
        .symbol-btn:hover, .symbol-btn.selected {
            background: var(--accent) !important;
            color: white;
            transform: scale(1.08);
            border-color: var(--accent) !important;
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        .category-badge {
            font-size: 0.6rem;
            padding: 2px 8px;
            border-radius: 9999px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toggle-switch {
            width: 44px; height: 24px;
            background: var(--border);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch.active { background: var(--accent); }
        .toggle-switch::after {
            content: '';
            width: 18px; height: 18px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 3px; left: 3px;
            transition: transform 0.3s;
        }
        .toggle-switch.active::after { transform: translateX(20px); }

        .stats-card {
            background: linear-gradient(145deg, rgba(22,22,37,0.7), rgba(14,14,24,0.85));
            border: 1px solid var(--border);
            transition: all 0.3s;
        }
        .stats-card:hover {
            border-color: rgba(124,108,255,0.3);
            transform: translateY(-2px);
        }

        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            outline: none;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px; height: 20px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid var(--bg-primary);
            box-shadow: 0 0 10px rgba(124,108,255,0.4);
        }
        .range-slider::-moz-range-thumb {
            width: 20px; height: 20px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid var(--bg-primary);
        }

        .passphrase-word {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 8px;
            margin: 2px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .passphrase-word:hover { transform: scale(1.05); }

        .fav-star { transition: all 0.2s; cursor: pointer; }
        .fav-star:hover { transform: scale(1.2); }
        .fav-star.active { color: #fbbf24; }

        .badge-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--accent-light), #c084fc, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pattern-bg {
            background-image: radial-gradient(rgba(124,108,255,0.07) 1px, transparent 1px);
            background-size: 24px 24px;
        }

        .history-item {
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .history-item:hover {
            border-left-color: var(--accent);
            background: rgba(124,108,255,0.05);
        }

        .lock-screen {
            background: linear-gradient(135deg, #06060c 0%, #0a0a1a 50%, #06060c 100%);
            z-index: 200;
        }

        .lock-icon-glow {
            animation: lockPulse 2s infinite;
        }

        .shield-glow {
            animation: shieldGlow 3s infinite;
        }

        .encrypt-badge {
            background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05));
            border: 1px solid rgba(34,197,94,0.3);
        }

        .master-key-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        @media (max-width: 640px) {
            .mobile-stack { flex-direction: column; }
        }
    </style>
</head>
<body class="pattern-bg">

<!-- Lock Screen Overlay -->
<div id="lockScreen" class="fixed inset-0 lock-screen hidden flex-col items-center justify-center p-6">
    <div class="text-center max-w-md w-full">
        <div class="w-24 h-24 rounded-3xl bg-gradient-to-br from-[--warning] to-orange-600 flex items-center justify-center mx-auto mb-6 shadow-2xl lock-icon-glow">
            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
        </div>
        <h2 class="text-3xl font-extrabold mb-2">Vault Locked</h2>
        <p class="text-[--text-secondary] mb-1 text-sm">KeyForge Pro v3.0 ‚Äî <span class="text-[--accent-light]">AES-256-GCM Encrypted</span></p>
        <p class="text-[--text-muted] text-xs mb-6">Enter your Master Key to unlock the vault</p>

        <div class="relative mb-4">
            <input type="password" id="unlockKeyInput" class="input-dark w-full rounded-xl px-5 py-4 text-center text-lg mono pr-12" placeholder="Enter Master Key..." onkeydown="if(event.key==='Enter')unlockVault()">
            <button onclick="toggleUnlockVis()" class="absolute right-4 top-1/2 -translate-y-1/2 text-[--text-muted] hover:text-white transition">
                <svg id="unlockVisIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>
            </button>
        </div>
        <div id="unlockError" class="text-[--danger] text-sm mb-4 hidden">‚ùå Incorrect Master Key. Try again.</div>
        <button onclick="unlockVault()" class="btn-warning w-full rounded-xl py-4 text-sm font-bold text-white flex items-center justify-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg>
            Unlock Vault
        </button>

        <div class="mt-6 pt-5 border-t border-[--border]">
            <p class="text-[0.65rem] text-[--text-muted] mb-2">üîí AES-256-GCM ‚Ä¢ PBKDF2 (100K iterations) ‚Ä¢ SHA-256</p>
            <p class="text-[0.6rem] text-[--text-muted]">by <span class="text-[--accent-light] font-semibold">Sudhir Kumar</span> (@SudhirDevOps1)</p>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toast-container" class="fixed bottom-6 right-6 z-[100] flex flex-col gap-2 max-w-sm"></div>

<!-- Header -->
<header id="mainHeader" class="sticky top-0 z-50 border-b border-[--border]" style="background:rgba(6,6,12,0.92);backdrop-filter:blur(24px)">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-[--accent] to-[--accent-dark] flex items-center justify-center shadow-lg shadow-[--accent]/20">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
            </div>
            <div>
                <h1 class="text-lg font-extrabold tracking-tight">KeyForge <span class="text-[--accent] text-xs font-bold">PRO</span></h1>
                <p class="text-[0.6rem] text-[--text-muted] -mt-0.5">by <span class="text-[--accent-light] font-semibold">SudhirDevOps1</span></p>
            </div>
            <!-- Encryption Status Badge -->
            <div id="encryptionBadge" class="hidden sm:flex items-center gap-1.5 ml-2 encrypt-badge rounded-full px-2.5 py-1 cursor-pointer" onclick="showMasterKeySettings()" title="Encryption active">
                <svg class="w-3.5 h-3.5 text-[--success] shield-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                <span class="text-[0.6rem] text-[--success] font-bold">AES-256</span>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <!-- Lock/Unlock Button -->
            <button id="lockBtn" onclick="lockVaultAction()" class="btn-outline rounded-lg p-2 text-[--text-secondary] hover:text-[--warning] relative hidden" title="Lock Vault">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </button>
            <!-- Master Key Button -->
            <button onclick="showMasterKeySettings()" class="btn-outline rounded-lg p-2 text-[--text-secondary] hover:text-[--warning] relative" title="Master Key & Encryption">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                <span id="masterKeyDot" class="absolute -top-0.5 -right-0.5 master-key-dot bg-[--danger] hidden"></span>
            </button>
            <button onclick="showHistory()" class="btn-outline rounded-lg p-2 text-[--text-secondary] hover:text-white relative" title="History">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span id="history-badge" class="absolute -top-1 -right-1 w-4 h-4 bg-[--accent] text-white text-[0.55rem] rounded-full flex items-center justify-center font-bold hidden">0</span>
            </button>
            <button onclick="showImportExport()" class="btn-outline rounded-lg px-3 py-2 text-sm flex items-center gap-2 text-[--text-secondary] hover:text-white">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>
                <span class="hidden sm:inline">Import / Export</span>
            </button>
            <button onclick="showShortcuts()" class="btn-outline rounded-lg p-2 text-[--text-secondary] hover:text-white" title="Keyboard Shortcuts">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"/></svg>
            </button>
            <button onclick="showInfo()" class="btn-outline rounded-lg p-2 text-[--text-secondary] hover:text-white" title="About">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </button>
        </div>
    </div>
</header>

<!-- Main Content -->
<main id="mainContent" class="max-w-7xl mx-auto px-4 sm:px-6 py-6">

    <!-- Hero Section -->
    <div class="hero-gradient rounded-2xl p-6 sm:p-8 mb-6 text-center slide-up relative overflow-hidden">
        <div class="absolute top-3 right-4 flex items-center gap-2">
            <span id="heroCryptoBadge" class="hidden text-[0.6rem] text-[--success] bg-green-500/10 px-2 py-1 rounded-full border border-green-500/20 font-bold">üîê Encrypted</span>
            <span class="text-[0.6rem] text-[--text-muted] bg-[--bg-card] px-2 py-1 rounded-full border border-[--border]">v3.0</span>
        </div>
        <h2 class="text-2xl sm:text-3xl font-extrabold mb-2">Craft Passwords You'll <span class="gradient-text">Never Forget</span></h2>
        <p class="text-[--text-secondary] max-w-2xl mx-auto text-sm sm:text-base mb-1">Smart formula: <span class="mono text-[--accent-light] text-sm bg-[--bg-card] px-2 py-1 rounded border border-[--border]">[Base] + [Site] + [Symbol] + [Year]</span></p>
        <p class="text-[0.7rem] text-[--text-muted]">Now with <span class="text-[--warning] font-bold">AES-256-GCM Encryption</span> ‚Ä¢ Passphrase Generator ‚Ä¢ Random Passwords ‚Ä¢ Strength Checker & more!</p>
    </div>

    <!-- Stats Row -->
    <div class="grid grid-cols-2 sm:grid-cols-6 gap-3 mb-6 fade-in">
        <div class="stats-card rounded-xl p-4 text-center">
            <div id="stat-total" class="text-2xl font-extrabold text-[--accent-light]">0</div>
            <div class="text-[0.65rem] text-[--text-secondary] mt-1">Total Saved</div>
        </div>
        <div class="stats-card rounded-xl p-4 text-center">
            <div id="stat-strong" class="text-2xl font-extrabold text-[--success]">0</div>
            <div class="text-[0.65rem] text-[--text-secondary] mt-1">Strong</div>
        </div>
        <div class="stats-card rounded-xl p-4 text-center">
            <div id="stat-medium" class="text-2xl font-extrabold text-[--warning]">0</div>
            <div class="text-[0.65rem] text-[--text-secondary] mt-1">Medium</div>
        </div>
        <div class="stats-card rounded-xl p-4 text-center">
            <div id="stat-weak" class="text-2xl font-extrabold text-[--danger]">0</div>
            <div class="text-[0.65rem] text-[--text-secondary] mt-1">Weak</div>
        </div>
        <div class="stats-card rounded-xl p-4 text-center">
            <div id="stat-favs" class="text-2xl font-extrabold text-yellow-400">0</div>
            <div class="text-[0.65rem] text-[--text-secondary] mt-1">‚òÖ Favorites</div>
        </div>
        <div class="stats-card rounded-xl p-4 text-center col-span-2 sm:col-span-1">
            <div id="stat-encrypted" class="text-2xl font-extrabold text-[--success]">‚Äî</div>
            <div class="text-[0.65rem] text-[--text-secondary] mt-1">üîê Encryption</div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="flex gap-0.5 mb-6 border-b border-[--border] overflow-x-auto pb-0 scrollbar-hide">
        <button onclick="switchTab('generator')" class="tab-btn active px-3 sm:px-4 py-3 text-sm font-medium whitespace-nowrap" data-tab="generator">
            <span class="flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                <span class="hidden sm:inline">Formula</span> Gen
            </span>
        </button>
        <button onclick="switchTab('passphrase')" class="tab-btn px-3 sm:px-4 py-3 text-sm font-medium whitespace-nowrap" data-tab="passphrase">
            <span class="flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/></svg>
                Passphrase
            </span>
        </button>
        <button onclick="switchTab('random')" class="tab-btn px-3 sm:px-4 py-3 text-sm font-medium whitespace-nowrap" data-tab="random">
            <span class="flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                Random
            </span>
        </button>
        <button onclick="switchTab('checker')" class="tab-btn px-3 sm:px-4 py-3 text-sm font-medium whitespace-nowrap" data-tab="checker">
            <span class="flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                Checker
            </span>
        </button>
        <button onclick="switchTab('vault')" class="tab-btn px-3 sm:px-4 py-3 text-sm font-medium whitespace-nowrap" data-tab="vault">
            <span class="flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                Vault <span id="vault-count" class="bg-[--accent] text-white text-[0.6rem] px-1.5 py-0.5 rounded-full ml-0.5 font-bold">0</span>
            </span>
        </button>
        <button onclick="switchTab('formula')" class="tab-btn px-3 sm:px-4 py-3 text-sm font-medium whitespace-nowrap" data-tab="formula">
            <span class="flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                Guide
            </span>
        </button>
    </div>

    <!-- ==================== FORMULA GENERATOR TAB ==================== -->
    <div id="tab-generator" class="tab-content slide-up">
        <div class="grid lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-lg font-bold mb-5 flex items-center gap-2">
                    <svg class="w-5 h-5 text-[--accent]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/></svg>
                    Build Your Password
                </h3>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Base Word <span class="text-[--text-muted] text-xs">(your secret word)</span></label>
                    <input type="text" id="baseWord" class="input-dark w-full rounded-xl px-4 py-3 text-sm" placeholder="e.g., Kitab, Dragon, Star..." oninput="generatePassword()">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Site / Service</label>
                    <input type="text" id="siteName" class="input-dark w-full rounded-xl px-4 py-3 text-sm" placeholder="e.g., Instagram, Gmail..." oninput="generatePassword()">
                    <div class="flex flex-wrap gap-1.5 mt-2">
                        <button onclick="quickFill('Google')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Google</button>
                        <button onclick="quickFill('Instagram')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Instagram</button>
                        <button onclick="quickFill('Facebook')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Facebook</button>
                        <button onclick="quickFill('Twitter')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Twitter</button>
                        <button onclick="quickFill('GitHub')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">GitHub</button>
                        <button onclick="quickFill('Amazon')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Amazon</button>
                        <button onclick="quickFill('Netflix')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Netflix</button>
                        <button onclick="quickFill('Discord')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Discord</button>
                        <button onclick="quickFill('LinkedIn')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">LinkedIn</button>
                        <button onclick="quickFill('Spotify')" class="text-[0.65rem] bg-[--bg-card] hover:bg-[--accent]/20 border border-[--border] px-2 py-1 rounded-lg transition">Spotify</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Separator</label>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="selectSeparator('-')" class="symbol-btn selected mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sep="-">-</button>
                        <button onclick="selectSeparator('_')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sep="_">_</button>
                        <button onclick="selectSeparator('.')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sep=".">.</button>
                        <button onclick="selectSeparator('~')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sep="~">~</button>
                        <button onclick="selectSeparator('+')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sep="+">+</button>
                        <button onclick="selectSeparator('')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-[0.6rem] font-bold" data-sep="">none</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Special Symbol</label>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="selectSymbol('@')" class="symbol-btn selected mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="@">@</button>
                        <button onclick="selectSymbol('#')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="#">#</button>
                        <button onclick="selectSymbol('!')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="!">!</button>
                        <button onclick="selectSymbol('$')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="$">$</button>
                        <button onclick="selectSymbol('%')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="%">%</button>
                        <button onclick="selectSymbol('&')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="&">&</button>
                        <button onclick="selectSymbol('*')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="*">*</button>
                        <button onclick="selectSymbol('^')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-sym="^">^</button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Year / Number</label>
                        <input type="text" id="yearNum" class="input-dark w-full rounded-xl px-4 py-3 text-sm" value="2026" oninput="generatePassword()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Category</label>
                        <select id="category" class="input-dark w-full rounded-xl px-4 py-3 text-sm">
                            <option value="social">Social Media</option>
                            <option value="email">Email</option>
                            <option value="finance">Finance / Banking</option>
                            <option value="work">Work / Office</option>
                            <option value="shopping">Shopping</option>
                            <option value="dev">Developer</option>
                            <option value="gaming">Gaming</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="education">Education</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Site Abbreviation <span class="text-[--accent] text-xs">(in password)</span></label>
                    <input type="text" id="siteShort" class="input-dark w-full rounded-xl px-4 py-3 text-sm mono" placeholder="Auto-generated..." oninput="generatePassword()">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Username / Email <span class="text-[--text-muted] text-xs">(saved to vault)</span></label>
                    <input type="text" id="username" class="input-dark w-full rounded-xl px-4 py-3 text-sm" placeholder="your@email.com">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Website URL <span class="text-[--text-muted] text-xs">(optional)</span></label>
                    <input type="url" id="siteUrl" class="input-dark w-full rounded-xl px-4 py-3 text-sm" placeholder="https://example.com">
                </div>
                <div class="mb-5">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">Notes <span class="text-[--text-muted] text-xs">(optional)</span></label>
                    <textarea id="notes" class="input-dark w-full rounded-xl px-4 py-3 text-sm resize-none" rows="2" placeholder="Any extra notes..."></textarea>
                </div>
                <button onclick="saveToVault()" class="btn-primary w-full rounded-xl py-3.5 text-sm font-bold text-white flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                    Save to Vault
                </button>
            </div>
            <div class="space-y-5">
                <div class="glass-card glow-border rounded-2xl p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-[--accent]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        Generated Password
                    </h3>
                    <div class="password-display rounded-xl p-5 mb-4 text-center">
                        <div id="passwordPreview" class="mono text-xl sm:text-2xl font-bold text-[--accent-light] break-all select-all min-h-[2rem] flex items-center justify-center">
                            <span class="text-[--text-muted] text-base font-normal">Fill the fields to generate...</span>
                        </div>
                    </div>
                    <div id="formulaBreakdown" class="bg-[--bg-primary] rounded-xl p-4 mb-4 hidden">
                        <div class="text-[0.65rem] text-[--text-muted] mb-2 font-semibold tracking-wider">FORMULA BREAKDOWN</div>
                        <div class="flex flex-wrap items-center gap-1 mono text-sm" id="formulaParts"></div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-[--text-secondary]">Strength</span>
                            <span id="strengthLabel" class="text-sm font-bold">‚Äî</span>
                        </div>
                        <div class="w-full h-2.5 bg-[--bg-primary] rounded-full overflow-hidden">
                            <div id="strengthBar" class="strength-bar h-full rounded-full" style="width:0%"></div>
                        </div>
                        <div id="crackTime" class="text-[0.65rem] text-[--text-muted] mt-1.5 text-right"></div>
                    </div>
                    <div class="grid grid-cols-4 gap-2 mb-4">
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center">
                            <div id="charCount" class="text-lg font-bold text-[--accent-light]">0</div>
                            <div class="text-[0.6rem] text-[--text-muted]">Length</div>
                        </div>
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center">
                            <div id="upperCount" class="text-lg font-bold text-blue-400">0</div>
                            <div class="text-[0.6rem] text-[--text-muted]">Upper</div>
                        </div>
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center">
                            <div id="specialCount" class="text-lg font-bold text-[--warning]">0</div>
                            <div class="text-[0.6rem] text-[--text-muted]">Special</div>
                        </div>
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center">
                            <div id="entropyBits" class="text-lg font-bold text-[--success]">0</div>
                            <div class="text-[0.6rem] text-[--text-muted]">Entropy</div>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="copyPassword()" class="btn-primary flex-1 rounded-xl py-3 text-sm font-bold text-white flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/></svg>
                            Copy
                        </button>
                        <button onclick="togglePasswordVisibility()" id="toggleVisBtn" class="btn-outline rounded-xl px-4 py-3 text-sm text-[--text-secondary] flex items-center gap-2">
                            <svg id="visIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>
                            <span>Hide</span>
                        </button>
                    </div>
                </div>
                <div class="glass-card rounded-2xl p-5">
                    <h4 class="text-sm font-bold mb-3 flex items-center gap-2"><span class="text-[--warning]">üí°</span> Pro Tips</h4>
                    <ul class="space-y-2 text-xs text-[--text-secondary]">
                        <li class="flex gap-2"><span class="text-[--success]">‚úì</span> Use a base word only YOU know</li>
                        <li class="flex gap-2"><span class="text-[--success]">‚úì</span> Mix capitalization for extra strength</li>
                        <li class="flex gap-2"><span class="text-[--success]">‚úì</span> Set a Master Key to encrypt your exports</li>
                        <li class="flex gap-2"><span class="text-[--success]">‚úì</span> Use different symbols for different categories</li>
                        <li class="flex gap-2"><span class="text-[--danger]">‚úó</span> Never share your base word or master key</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== PASSPHRASE TAB ==================== -->
    <div id="tab-passphrase" class="tab-content hidden">
        <div class="grid lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-lg font-bold mb-2 flex items-center gap-2"><span class="text-2xl">üé≤</span> Passphrase Generator</h3>
                <p class="text-xs text-[--text-secondary] mb-5">Generate strong, memorable passphrases using random words.</p>
                <div class="mb-5">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-2">Number of Words: <span id="ppWordCountLabel" class="text-[--accent-light] font-bold">4</span></label>
                    <input type="range" id="ppWordCount" class="range-slider" min="3" max="8" value="4" oninput="document.getElementById('ppWordCountLabel').textContent=this.value;generatePassphrase()">
                </div>
                <div class="mb-5">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-2">Separator</label>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="selectPPSep('-')" class="symbol-btn selected mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-ppsep="-">-</button>
                        <button onclick="selectPPSep('_')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-ppsep="_">_</button>
                        <button onclick="selectPPSep('.')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-lg font-bold" data-ppsep=".">.</button>
                        <button onclick="selectPPSep(' ')" class="symbol-btn mono w-10 h-10 rounded-lg bg-[--bg-card] border border-[--border] flex items-center justify-center text-xs font-bold" data-ppsep=" ">space</button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-5">
                    <label class="flex items-center gap-3 cursor-pointer bg-[--bg-input] rounded-xl p-3 border border-[--border]">
                        <input type="checkbox" id="ppCapitalize" checked onchange="generatePassphrase()" class="w-4 h-4 rounded accent-[--accent]">
                        <div><div class="text-sm font-medium">Capitalize</div><div class="text-[0.6rem] text-[--text-muted]">First letter</div></div>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer bg-[--bg-input] rounded-xl p-3 border border-[--border]">
                        <input type="checkbox" id="ppAddNumber" checked onchange="generatePassphrase()" class="w-4 h-4 rounded accent-[--accent]">
                        <div><div class="text-sm font-medium">Add Number</div><div class="text-[0.6rem] text-[--text-muted]">Append number</div></div>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer bg-[--bg-input] rounded-xl p-3 border border-[--border]">
                        <input type="checkbox" id="ppAddSymbol" checked onchange="generatePassphrase()" class="w-4 h-4 rounded accent-[--accent]">
                        <div><div class="text-sm font-medium">Add Symbol</div><div class="text-[0.6rem] text-[--text-muted]">Special char</div></div>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer bg-[--bg-input] rounded-xl p-3 border border-[--border]">
                        <input type="checkbox" id="ppL33t" onchange="generatePassphrase()" class="w-4 h-4 rounded accent-[--accent]">
                        <div><div class="text-sm font-medium">L33t Speak</div><div class="text-[0.6rem] text-[--text-muted]">a‚Üí4, e‚Üí3</div></div>
                    </label>
                </div>
                <div class="mb-5">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">For Site <span class="text-[--text-muted] text-xs">(optional)</span></label>
                    <input type="text" id="ppSiteName" class="input-dark w-full rounded-xl px-4 py-3 text-sm" placeholder="e.g., Instagram, Gmail...">
                </div>
                <div class="flex gap-3">
                    <button onclick="generatePassphrase()" class="btn-primary flex-1 rounded-xl py-3.5 text-sm font-bold text-white flex items-center justify-center gap-2">üé≤ Generate New</button>
                    <button onclick="savePassphraseToVault()" class="btn-success rounded-xl px-5 py-3.5 text-sm font-bold text-white flex items-center justify-center gap-2">üíæ Save</button>
                </div>
            </div>
            <div class="space-y-5">
                <div class="glass-card glow-border-success rounded-2xl p-6">
                    <h3 class="text-lg font-bold mb-4">üîê Your Passphrase</h3>
                    <div class="password-display rounded-xl p-5 mb-4 text-center">
                        <div id="passphrasePreview" class="mono text-lg sm:text-xl font-bold text-[--success] break-all min-h-[3rem] flex items-center justify-center leading-relaxed"></div>
                    </div>
                    <div id="ppWordBreakdown" class="bg-[--bg-primary] rounded-xl p-4 mb-4">
                        <div class="text-[0.65rem] text-[--text-muted] mb-2 font-semibold tracking-wider">WORD BREAKDOWN</div>
                        <div id="ppWords" class="flex flex-wrap gap-1"></div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-[--text-secondary]">Strength</span>
                            <span id="ppStrengthLabel" class="text-sm font-bold">‚Äî</span>
                        </div>
                        <div class="w-full h-2.5 bg-[--bg-primary] rounded-full overflow-hidden">
                            <div id="ppStrengthBar" class="strength-bar h-full rounded-full" style="width:0%"></div>
                        </div>
                        <div id="ppCrackTime" class="text-[0.65rem] text-[--text-muted] mt-1.5 text-right"></div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center"><div id="ppCharCount" class="text-lg font-bold text-[--accent-light]">0</div><div class="text-[0.6rem] text-[--text-muted]">Length</div></div>
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center"><div id="ppWordTotal" class="text-lg font-bold text-[--info]">0</div><div class="text-[0.6rem] text-[--text-muted]">Words</div></div>
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center"><div id="ppEntropy" class="text-lg font-bold text-[--success]">0</div><div class="text-[0.6rem] text-[--text-muted]">Entropy</div></div>
                    </div>
                    <button onclick="copyPassphrase()" class="btn-success w-full rounded-xl py-3 text-sm font-bold text-white flex items-center justify-center gap-2">üìã Copy Passphrase</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== RANDOM TAB ==================== -->
    <div id="tab-random" class="tab-content hidden">
        <div class="grid lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-lg font-bold mb-2 flex items-center gap-2"><span class="text-2xl">üé∞</span> Random Password Generator</h3>
                <p class="text-xs text-[--text-secondary] mb-5">Cryptographically random passwords with custom rules.</p>
                <div class="mb-5">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-2">Length: <span id="rpLengthLabel" class="text-[--accent-light] font-bold mono">16</span></label>
                    <input type="range" id="rpLength" class="range-slider" min="6" max="64" value="16" oninput="document.getElementById('rpLengthLabel').textContent=this.value;generateRandom()">
                </div>
                <div class="space-y-3 mb-5">
                    <label class="flex items-center justify-between cursor-pointer bg-[--bg-input] rounded-xl p-3.5 border border-[--border]">
                        <div class="flex items-center gap-3"><span class="mono text-sm font-bold text-blue-400 w-8">Aa</span><div><div class="text-sm font-medium">Uppercase</div></div></div>
                        <input type="checkbox" id="rpUpper" checked onchange="generateRandom()" class="w-4 h-4 rounded accent-[--accent]">
                    </label>
                    <label class="flex items-center justify-between cursor-pointer bg-[--bg-input] rounded-xl p-3.5 border border-[--border]">
                        <div class="flex items-center gap-3"><span class="mono text-sm font-bold text-green-400 w-8">ab</span><div><div class="text-sm font-medium">Lowercase</div></div></div>
                        <input type="checkbox" id="rpLower" checked onchange="generateRandom()" class="w-4 h-4 rounded accent-[--accent]">
                    </label>
                    <label class="flex items-center justify-between cursor-pointer bg-[--bg-input] rounded-xl p-3.5 border border-[--border]">
                        <div class="flex items-center gap-3"><span class="mono text-sm font-bold text-yellow-400 w-8">12</span><div><div class="text-sm font-medium">Numbers</div></div></div>
                        <input type="checkbox" id="rpNumbers" checked onchange="generateRandom()" class="w-4 h-4 rounded accent-[--accent]">
                    </label>
                    <label class="flex items-center justify-between cursor-pointer bg-[--bg-input] rounded-xl p-3.5 border border-[--border]">
                        <div class="flex items-center gap-3"><span class="mono text-sm font-bold text-red-400 w-8">@#</span><div><div class="text-sm font-medium">Symbols</div></div></div>
                        <input type="checkbox" id="rpSymbols" checked onchange="generateRandom()" class="w-4 h-4 rounded accent-[--accent]">
                    </label>
                    <label class="flex items-center justify-between cursor-pointer bg-[--bg-input] rounded-xl p-3.5 border border-[--border]">
                        <div><div class="text-sm font-medium">Exclude Ambiguous</div><div class="text-[0.6rem] text-[--text-muted]">0 O o l I 1</div></div>
                        <input type="checkbox" id="rpExcludeAmbiguous" onchange="generateRandom()" class="w-4 h-4 rounded accent-[--accent]">
                    </label>
                </div>
                <div class="mb-5">
                    <label class="block text-sm font-medium text-[--text-secondary] mb-1.5">For Site <span class="text-[--text-muted] text-xs">(optional)</span></label>
                    <input type="text" id="rpSiteName" class="input-dark w-full rounded-xl px-4 py-3 text-sm" placeholder="e.g., Instagram...">
                </div>
                <div class="flex gap-3">
                    <button onclick="generateRandom()" class="btn-primary flex-1 rounded-xl py-3.5 text-sm font-bold text-white">üîÑ Generate</button>
                    <button onclick="saveRandomToVault()" class="btn-success rounded-xl px-5 py-3.5 text-sm font-bold text-white">üíæ Save</button>
                </div>
            </div>
            <div class="space-y-5">
                <div class="glass-card glow-border rounded-2xl p-6">
                    <h3 class="text-lg font-bold mb-4">üîë Generated Password</h3>
                    <div class="password-display rounded-xl p-5 mb-4 text-center">
                        <div id="randomPreview" class="mono text-lg sm:text-xl font-bold text-[--accent-light] break-all min-h-[2rem] flex items-center justify-center select-all"></div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2"><span class="text-sm text-[--text-secondary]">Strength</span><span id="rpStrengthLabel" class="text-sm font-bold">‚Äî</span></div>
                        <div class="w-full h-2.5 bg-[--bg-primary] rounded-full overflow-hidden"><div id="rpStrengthBar" class="strength-bar h-full rounded-full" style="width:0%"></div></div>
                        <div id="rpCrackTime" class="text-[0.65rem] text-[--text-muted] mt-1.5 text-right"></div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center"><div id="rpCharCount" class="text-lg font-bold text-[--accent-light]">0</div><div class="text-[0.6rem] text-[--text-muted]">Length</div></div>
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center"><div id="rpSpecCount" class="text-lg font-bold text-[--warning]">0</div><div class="text-[0.6rem] text-[--text-muted]">Specials</div></div>
                        <div class="bg-[--bg-primary] rounded-lg p-3 text-center"><div id="rpEntropyBits" class="text-lg font-bold text-[--success]">0</div><div class="text-[0.6rem] text-[--text-muted]">Entropy</div></div>
                    </div>
                    <button onclick="copyRandomPassword()" class="btn-primary w-full rounded-xl py-3 text-sm font-bold text-white flex items-center justify-center gap-2">üìã Copy Password</button>
                </div>
                <div class="glass-card rounded-2xl p-5">
                    <h4 class="text-sm font-bold mb-3">‚ö° Batch Generate</h4>
                    <div class="flex gap-2 mb-3">
                        <select id="batchCount" class="input-dark rounded-xl px-3 py-2 text-sm flex-1">
                            <option value="5">5 passwords</option>
                            <option value="10">10 passwords</option>
                            <option value="20">20 passwords</option>
                        </select>
                        <button onclick="batchGenerate()" class="btn-outline rounded-xl px-4 py-2 text-sm font-semibold text-[--text-secondary] hover:text-white">Go</button>
                    </div>
                    <div id="batchResults" class="space-y-1 max-h-48 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== CHECKER TAB ==================== -->
    <div id="tab-checker" class="tab-content hidden">
        <div class="max-w-2xl mx-auto">
            <div class="glass-card rounded-2xl p-6 sm:p-8">
                <h3 class="text-xl font-bold mb-2 flex items-center gap-2"><span class="text-2xl">üõ°Ô∏è</span> Password Strength Checker</h3>
                <p class="text-sm text-[--text-secondary] mb-6">All analysis happens locally. Nothing is sent anywhere.</p>
                <div class="mb-6 relative">
                    <input type="text" id="checkerInput" class="input-dark w-full rounded-xl px-4 py-4 text-lg mono pr-12" placeholder="Type or paste a password..." oninput="analyzePassword()">
                    <button onclick="toggleCheckerVis()" class="absolute right-3 top-1/2 -translate-y-1/2 text-[--text-muted] hover:text-white transition p-1">
                        <svg id="checkerVisIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                    </button>
                </div>
                <div id="checkerResults" class="hidden">
                    <div class="mb-5">
                        <div class="flex justify-between items-center mb-2"><span class="text-sm font-medium">Overall Strength</span><span id="ckStrengthLabel" class="text-lg font-extrabold">‚Äî</span></div>
                        <div class="w-full h-3 bg-[--bg-primary] rounded-full overflow-hidden"><div id="ckStrengthBar" class="strength-bar h-full rounded-full" style="width:0%"></div></div>
                        <div id="ckCrackTime" class="text-xs text-[--text-muted] mt-2 text-right"></div>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-5">
                        <div class="bg-[--bg-primary] rounded-xl p-4 text-center"><div id="ckLength" class="text-2xl font-extrabold text-[--accent-light]">0</div><div class="text-[0.6rem] text-[--text-muted] mt-1">Characters</div></div>
                        <div class="bg-[--bg-primary] rounded-xl p-4 text-center"><div id="ckEntropy" class="text-2xl font-extrabold text-[--success]">0</div><div class="text-[0.6rem] text-[--text-muted] mt-1">Entropy Bits</div></div>
                        <div class="bg-[--bg-primary] rounded-xl p-4 text-center"><div id="ckCharset" class="text-2xl font-extrabold text-[--warning]">0</div><div class="text-[0.6rem] text-[--text-muted] mt-1">Charset Size</div></div>
                        <div class="bg-[--bg-primary] rounded-xl p-4 text-center"><div id="ckScore" class="text-2xl font-extrabold text-[--info]">0</div><div class="text-[0.6rem] text-[--text-muted] mt-1">Score / 10</div></div>
                    </div>
                    <div class="space-y-2 mb-5" id="ckChecklist"></div>
                    <div class="bg-[--bg-primary] rounded-xl p-4">
                        <div class="text-xs font-semibold text-[--text-muted] mb-2 tracking-wider">CHARACTER COMPOSITION</div>
                        <div class="grid grid-cols-4 gap-2" id="ckComposition"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== VAULT TAB ==================== -->
    <div id="tab-vault" class="tab-content hidden">
        <div class="flex flex-col sm:flex-row gap-3 mb-5">
            <div class="flex-1 relative">
                <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-[--text-muted]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                <input type="text" id="searchVault" class="input-dark w-full rounded-xl pl-10 pr-4 py-3 text-sm" placeholder="Search vault..." oninput="renderVault()">
            </div>
            <select id="filterCategory" class="input-dark rounded-xl px-4 py-3 text-sm" onchange="renderVault()">
                <option value="all">All Categories</option>
                <option value="favorites">‚òÖ Favorites</option>
                <option value="social">Social Media</option>
                <option value="email">Email</option>
                <option value="finance">Finance</option>
                <option value="work">Work</option>
                <option value="shopping">Shopping</option>
                <option value="dev">Developer</option>
                <option value="gaming">Gaming</option>
                <option value="entertainment">Entertainment</option>
                <option value="education">Education</option>
                <option value="other">Other</option>
            </select>
            <select id="sortBy" class="input-dark rounded-xl px-4 py-3 text-sm" onchange="renderVault()">
                <option value="newest">Newest First</option>
                <option value="oldest">Oldest First</option>
                <option value="name">A ‚Üí Z</option>
                <option value="name-desc">Z ‚Üí A</option>
                <option value="strength">Strongest First</option>
            </select>
        </div>
        <div id="vaultList" class="space-y-2"></div>
        <div id="vaultEmpty" class="hidden text-center py-16">
            <svg class="w-16 h-16 mx-auto text-[--border] mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            <h3 class="text-lg font-bold text-[--text-secondary] mb-1">Vault is Empty</h3>
            <p class="text-sm text-[--text-muted]">Generate and save passwords to see them here.</p>
        </div>
    </div>

    <!-- ==================== FORMULA GUIDE TAB ==================== -->
    <div id="tab-formula" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-6 sm:p-8 mb-6">
            <h3 class="text-xl font-extrabold mb-4">üîê The Smart Password Formula</h3>
            <p class="text-sm text-[--text-secondary] mb-5">Developed by <strong class="text-[--accent-light]">Sudhir Kumar (SudhirDevOps1)</strong></p>
            <div class="bg-[--bg-primary] rounded-xl p-5 mb-6 text-center">
                <div class="mono text-base sm:text-lg text-[--accent-light] leading-relaxed">
                    <span class="text-[--success]">[Base Word]</span>
                    <span class="text-[--text-muted]"> + </span>
                    <span class="text-[--warning]">[Separator]</span>
                    <span class="text-[--text-muted]"> + </span>
                    <span class="text-blue-400">[Site Abbr]</span>
                    <span class="text-[--text-muted]"> + </span>
                    <span class="text-[--danger]">[Symbol]</span>
                    <span class="text-[--text-muted]"> + </span>
                    <span class="text-purple-400">[Year]</span>
                </div>
            </div>
            <div class="space-y-3">
                <div class="bg-[--bg-primary] rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2"><span class="text-sm font-medium">üì∏ Instagram</span><span class="mono text-[--accent-light] text-sm select-all font-bold">Kitab-Insta@2026</span></div>
                    <div class="flex gap-1 text-xs mono">
                        <span class="bg-green-500/20 text-green-400 px-2 py-0.5 rounded">Kitab</span><span class="bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded">-</span><span class="bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded">Insta</span><span class="bg-red-500/20 text-red-400 px-2 py-0.5 rounded">@</span><span class="bg-purple-500/20 text-purple-400 px-2 py-0.5 rounded">2026</span>
                    </div>
                </div>
                <div class="bg-[--bg-primary] rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2"><span class="text-sm font-medium">üìß Gmail</span><span class="mono text-[--accent-light] text-sm select-all font-bold">Kitab-Gma#2026</span></div>
                    <div class="flex gap-1 text-xs mono">
                        <span class="bg-green-500/20 text-green-400 px-2 py-0.5 rounded">Kitab</span><span class="bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded">-</span><span class="bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded">Gma</span><span class="bg-red-500/20 text-red-400 px-2 py-0.5 rounded">#</span><span class="bg-purple-500/20 text-purple-400 px-2 py-0.5 rounded">2026</span>
                    </div>
                </div>
                <div class="bg-[--bg-primary] rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2"><span class="text-sm font-medium">üë§ Facebook</span><span class="mono text-[--accent-light] text-sm select-all font-bold">Kitab-Face!2026</span></div>
                    <div class="flex gap-1 text-xs mono">
                        <span class="bg-green-500/20 text-green-400 px-2 py-0.5 rounded">Kitab</span><span class="bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded">-</span><span class="bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded">Face</span><span class="bg-red-500/20 text-red-400 px-2 py-0.5 rounded">!</span><span class="bg-purple-500/20 text-purple-400 px-2 py-0.5 rounded">2026</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid sm:grid-cols-2 gap-5">
            <div class="glass-card rounded-2xl p-6">
                <h4 class="font-bold mb-3 text-[--success]">‚úÖ Why This Works</h4>
                <ul class="space-y-2 text-sm text-[--text-secondary]">
                    <li>‚Ä¢ Every password is <strong class="text-white">unique per site</strong></li>
                    <li>‚Ä¢ Contains <strong class="text-white">mixed characters</strong></li>
                    <li>‚Ä¢ Easy to <strong class="text-white">reconstruct</strong> if you forget</li>
                    <li>‚Ä¢ Simple to <strong class="text-white">rotate</strong> by changing the year</li>
                    <li>‚Ä¢ Works <strong class="text-white">everywhere</strong> ‚Äî no app needed</li>
                </ul>
            </div>
            <div class="glass-card rounded-2xl p-6">
                <h4 class="font-bold mb-3 text-[--danger]">‚ö†Ô∏è Important Rules</h4>
                <ul class="space-y-2 text-sm text-[--text-secondary]">
                    <li>‚Ä¢ <strong class="text-white">Never</strong> share your base word</li>
                    <li>‚Ä¢ <strong class="text-white">Never</strong> share your master key</li>
                    <li>‚Ä¢ Use <strong class="text-white">different symbols</strong> for different sites</li>
                    <li>‚Ä¢ <strong class="text-white">Export regularly</strong> as encrypted backup</li>
                    <li>‚Ä¢ Vault is stored in <strong class="text-white">your browser only</strong></li>
                </ul>
            </div>
        </div>
    </div>
</main>

<!-- ==================== MODALS ==================== -->

<!-- Master Key Settings Modal -->
<div id="modal-masterkey" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-masterkey')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-lg slide-up max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-5">
            <h3 class="text-lg font-bold flex items-center gap-2">üîê Master Key & Encryption</h3>
            <button onclick="closeModal('modal-masterkey')" class="text-[--text-secondary] hover:text-white transition p-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <!-- Current status -->
        <div id="mkStatus" class="bg-[--bg-primary] rounded-xl p-4 mb-5">
            <div class="flex items-center gap-3 mb-2">
                <div id="mkStatusIcon" class="w-10 h-10 rounded-xl flex items-center justify-center bg-[--danger]/15">
                    <svg class="w-5 h-5 text-[--danger]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </div>
                <div>
                    <div id="mkStatusText" class="text-sm font-bold">No Master Key Set</div>
                    <div id="mkStatusSub" class="text-[0.65rem] text-[--text-muted]">Set a master key to enable encryption</div>
                </div>
            </div>
        </div>

        <!-- Encryption Info -->
        <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 mb-5">
            <h4 class="text-sm font-bold text-blue-400 mb-2">üõ°Ô∏è How Encryption Works</h4>
            <ul class="text-xs text-[--text-secondary] space-y-1">
                <li>‚Ä¢ Uses <strong class="text-white">AES-256-GCM</strong> ‚Äî military-grade encryption</li>
                <li>‚Ä¢ Key derived via <strong class="text-white">PBKDF2</strong> with 100,000 iterations</li>
                <li>‚Ä¢ Each export uses unique <strong class="text-white">Salt + IV</strong> (never reused)</li>
                <li>‚Ä¢ Master key is <strong class="text-white">never stored</strong> ‚Äî only its SHA-256 hash</li>
                <li>‚Ä¢ Export encrypted JSON ‚Üí Import months later with same key</li>
            </ul>
        </div>

        <!-- Set / Change Master Key -->
        <div id="mkSetSection">
            <h4 class="text-sm font-bold mb-3 text-[--accent-light]" id="mkSetTitle">üîë Set Master Key</h4>
            <div class="mb-3 relative">
                <input type="password" id="mkNewKey" class="input-dark w-full rounded-xl px-4 py-3 text-sm mono pr-10" placeholder="Enter master key (min 6 chars)..." oninput="checkMasterKeyStrength()">
                <button onclick="toggleMKVis('mkNewKey')" class="absolute right-3 top-1/2 -translate-y-1/2 text-[--text-muted] hover:text-white transition">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                </button>
            </div>
            <div class="mb-3">
                <div class="w-full h-1.5 bg-[--bg-primary] rounded-full overflow-hidden">
                    <div id="mkStrengthBar" class="strength-bar h-full rounded-full" style="width:0%"></div>
                </div>
                <div id="mkStrengthText" class="text-[0.6rem] text-[--text-muted] mt-1"></div>
            </div>
            <div class="mb-4 relative">
                <input type="password" id="mkConfirmKey" class="input-dark w-full rounded-xl px-4 py-3 text-sm mono pr-10" placeholder="Confirm master key..." onkeydown="if(event.key==='Enter')setMasterKey()">
                <button onclick="toggleMKVis('mkConfirmKey')" class="absolute right-3 top-1/2 -translate-y-1/2 text-[--text-muted] hover:text-white transition">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                </button>
            </div>
            <div id="mkError" class="text-[--danger] text-sm mb-3 hidden"></div>
            <button onclick="setMasterKey()" class="btn-warning w-full rounded-xl py-3 text-sm font-bold text-white flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                <span id="mkSetBtnText">Set Master Key</span>
            </button>
        </div>

        <!-- Remove Master Key -->
        <div id="mkRemoveSection" class="hidden mt-4 pt-4 border-t border-[--border]">
            <button onclick="removeMasterKey()" class="bg-[--danger]/15 text-[--danger] border border-[--danger]/25 hover:bg-[--danger]/25 w-full rounded-xl py-2.5 text-sm font-bold transition flex items-center justify-center gap-2">
                üóëÔ∏è Remove Master Key
            </button>
            <p class="text-[0.6rem] text-[--text-muted] mt-2 text-center">This won't affect already-encrypted exports. You'll need the original key to decrypt them.</p>
        </div>

        <div class="mt-5 pt-4 border-t border-[--border]">
            <div class="bg-[--warning]/10 border border-[--warning]/20 rounded-xl p-3">
                <p class="text-xs text-[--warning] font-bold mb-1">‚ö†Ô∏è IMPORTANT ‚Äî Remember your Master Key!</p>
                <p class="text-[0.65rem] text-[--text-secondary]">If you forget your master key, encrypted exports <strong class="text-white">cannot be recovered</strong>. There is no reset option. Write it down and keep it safe.</p>
            </div>
        </div>
    </div>
</div>

<!-- Import/Export Modal (Enhanced with Encryption) -->
<div id="modal-ie" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-ie')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-lg slide-up max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-5">
            <h3 class="text-lg font-bold">üì¶ Import / Export</h3>
            <button onclick="closeModal('modal-ie')" class="text-[--text-secondary] hover:text-white transition p-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <!-- Export Section -->
        <div class="mb-6">
            <h4 class="text-sm font-bold mb-3 text-[--accent-light]">üì§ Export Vault</h4>

            <!-- Encryption toggle for export -->
            <div id="exportEncryptOption" class="bg-[--bg-primary] rounded-xl p-4 mb-3">
                <label class="flex items-center justify-between cursor-pointer">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-[--warning]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                        <div>
                            <div class="text-sm font-medium">Encrypt Export</div>
                            <div class="text-[0.6rem] text-[--text-muted]" id="exportEncryptStatus">Set master key first</div>
                        </div>
                    </div>
                    <input type="checkbox" id="exportEncrypted" class="w-4 h-4 rounded accent-[--warning]" disabled>
                </label>
            </div>

            <!-- Custom key for this export (optional) -->
            <div id="exportCustomKeySection" class="hidden mb-3">
                <label class="flex items-center gap-2 mb-2">
                    <input type="checkbox" id="useCustomExportKey" onchange="toggleCustomExportKey()" class="w-4 h-4 rounded accent-[--accent]">
                    <span class="text-xs text-[--text-secondary]">Use custom key for this export (instead of master key)</span>
                </label>
                <div id="customExportKeyInput" class="hidden">
                    <input type="password" id="exportCustomKey" class="input-dark w-full rounded-xl px-4 py-2.5 text-sm mono" placeholder="Custom encryption key...">
                </div>
            </div>

            <div class="flex gap-2">
                <button onclick="exportJSON()" class="btn-primary flex-1 rounded-xl py-2.5 text-sm font-bold text-white flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    Export JSON
                </button>
                <button onclick="exportCSV()" class="btn-outline rounded-xl px-4 py-2.5 text-sm font-semibold text-[--text-secondary] hover:text-white">üìä CSV</button>
                <button onclick="copyVaultJSON()" class="btn-outline rounded-xl px-4 py-2.5 text-sm text-[--text-secondary] hover:text-white">üìã Copy</button>
            </div>
        </div>

        <div class="border-t border-[--border] my-5"></div>

        <!-- Import Section -->
        <div>
            <h4 class="text-sm font-bold mb-3 text-[--accent-light]">üì• Import Vault</h4>
            <p class="text-xs text-[--text-secondary] mb-3">Import from JSON file. Encrypted files will prompt for the master key.</p>
            
            <div class="mb-3">
                <label class="btn-outline rounded-xl py-2.5 text-sm text-[--text-secondary] hover:text-white flex items-center justify-center gap-2 cursor-pointer">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                    Choose JSON File
                    <input type="file" accept=".json,.csv" class="hidden" onchange="importFromFile(event)">
                </label>
            </div>

            <textarea id="importJSON" class="input-dark w-full rounded-xl px-4 py-3 text-sm mono resize-none" rows="5" placeholder="Or paste JSON data here..."></textarea>

            <!-- Decrypt key input (shown for encrypted imports) -->
            <div id="importDecryptSection" class="hidden mt-3">
                <div class="bg-[--warning]/10 border border-[--warning]/20 rounded-xl p-3 mb-3">
                    <div class="flex items-center gap-2 mb-1">
                        <svg class="w-4 h-4 text-[--warning]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                        <span class="text-sm font-bold text-[--warning]">Encrypted File Detected</span>
                    </div>
                    <p class="text-[0.65rem] text-[--text-secondary]">Enter the master key that was used to encrypt this file.</p>
                </div>
                <input type="password" id="importDecryptKey" class="input-dark w-full rounded-xl px-4 py-3 text-sm mono" placeholder="Enter decryption key...">
            </div>
            
            <div class="flex gap-2 mt-3">
                <button onclick="importFromText('merge')" class="btn-outline flex-1 rounded-xl py-2.5 text-sm font-bold text-[--text-secondary] hover:text-white">
                    Merge
                </button>
                <button onclick="importFromText('replace')" class="bg-[--danger]/20 text-[--danger] border border-[--danger]/30 hover:bg-[--danger]/30 flex-1 rounded-xl py-2.5 text-sm font-bold transition">
                    Replace All
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Info Modal -->
<div id="modal-info" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-info')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-lg slide-up max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-5">
            <h3 class="text-lg font-bold">About KeyForge Pro</h3>
            <button onclick="closeModal('modal-info')" class="text-[--text-secondary] hover:text-white transition p-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="space-y-4 text-sm text-[--text-secondary]">
            <div class="text-center mb-4">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-[--accent] to-[--accent-dark] flex items-center justify-center mx-auto mb-3 shadow-xl shadow-[--accent]/20">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
                </div>
                <h4 class="text-xl font-extrabold text-white">KeyForge <span class="text-[--accent]">Pro</span></h4>
                <p class="text-xs text-[--text-muted] mt-1">Version 3.0 ‚Äî Encrypted Edition</p>
            </div>
            <div class="bg-[--bg-primary] rounded-xl p-4 text-center">
                <div class="text-sm font-semibold text-white mb-1">üë®‚Äçüíª Developed by</div>
                <div class="text-lg font-extrabold gradient-text">Sudhir Kumar</div>
                <div class="mono text-xs text-[--accent-light] mt-1">@SudhirDevOps1</div>
                <div class="text-[0.65rem] text-[--text-muted] mt-2">Open Source ‚Ä¢ MIT License ‚Ä¢ Made with ‚ù§Ô∏è</div>
            </div>
            <div class="bg-[--bg-primary] rounded-xl p-4">
                <h4 class="font-bold text-white mb-2">üîê Encryption Details</h4>
                <ul class="space-y-1 text-xs">
                    <li>‚Ä¢ <strong class="text-[--warning]">AES-256-GCM</strong> ‚Äî Military-grade encryption</li>
                    <li>‚Ä¢ <strong class="text-[--warning]">PBKDF2</strong> ‚Äî 100,000 iterations key derivation</li>
                    <li>‚Ä¢ <strong class="text-[--warning]">SHA-256</strong> ‚Äî Master key hashing</li>
                    <li>‚Ä¢ Unique Salt + IV per export (never reused)</li>
                    <li>‚Ä¢ Master key never stored ‚Äî only its hash</li>
                    <li>‚Ä¢ Web Crypto API ‚Äî browser-native security</li>
                </ul>
            </div>
            <div class="bg-[--bg-primary] rounded-xl p-4">
                <h4 class="font-bold text-white mb-2">üöÄ All Features</h4>
                <ul class="space-y-1 text-xs">
                    <li>‚Ä¢ Formula-based smart password generator</li>
                    <li>‚Ä¢ Passphrase generator (random words)</li>
                    <li>‚Ä¢ Random password generator with crypto API</li>
                    <li>‚Ä¢ Password strength checker & analyzer</li>
                    <li>‚Ä¢ AES-256-GCM encrypted vault exports</li>
                    <li>‚Ä¢ Master key lock/unlock system</li>
                    <li>‚Ä¢ JSON & CSV import/export</li>
                    <li>‚Ä¢ Favorites, History, Batch generation</li>
                    <li>‚Ä¢ Keyboard shortcuts</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- View Entry Modal -->
<div id="modal-view" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-view')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-lg slide-up max-h-[90vh] overflow-y-auto" id="viewEntryContent"></div>
</div>

<!-- Delete Confirmation -->
<div id="modal-delete" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-delete')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-sm scale-in text-center">
        <div class="w-14 h-14 rounded-full bg-[--danger]/15 flex items-center justify-center mx-auto mb-4">
            <svg class="w-7 h-7 text-[--danger]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
        </div>
        <h3 class="text-lg font-bold mb-2">Delete Entry?</h3>
        <p class="text-sm text-[--text-secondary] mb-5">This cannot be undone.</p>
        <div class="flex gap-3">
            <button onclick="closeModal('modal-delete')" class="btn-outline flex-1 rounded-xl py-2.5 text-sm font-bold text-[--text-secondary]">Cancel</button>
            <button onclick="confirmDelete()" class="bg-[--danger] hover:bg-red-600 flex-1 rounded-xl py-2.5 text-sm font-bold text-white transition">Delete</button>
        </div>
    </div>
</div>

<!-- Clear All -->
<div id="modal-clearall" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-clearall')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-sm scale-in text-center">
        <div class="w-14 h-14 rounded-full bg-[--danger]/15 flex items-center justify-center mx-auto mb-4">
            <svg class="w-7 h-7 text-[--danger]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
        </div>
        <h3 class="text-lg font-bold mb-2">Clear Entire Vault?</h3>
        <p class="text-sm text-[--text-secondary] mb-5">All passwords + history will be permanently deleted.</p>
        <div class="flex gap-3">
            <button onclick="closeModal('modal-clearall')" class="btn-outline flex-1 rounded-xl py-2.5 text-sm font-bold text-[--text-secondary]">Cancel</button>
            <button onclick="confirmClearAll()" class="bg-[--danger] hover:bg-red-600 flex-1 rounded-xl py-2.5 text-sm font-bold text-white transition">Clear All</button>
        </div>
    </div>
</div>

<!-- History Modal -->
<div id="modal-history" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-history')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-lg slide-up max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-5">
            <h3 class="text-lg font-bold">üïê Password History</h3>
            <div class="flex items-center gap-2">
                <button onclick="clearHistory()" class="text-xs text-[--danger]/70 hover:text-[--danger] transition">Clear All</button>
                <button onclick="closeModal('modal-history')" class="text-[--text-secondary] hover:text-white transition p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
        </div>
        <p class="text-xs text-[--text-muted] mb-4">Click to copy. Last 50 generated passwords.</p>
        <div id="historyList" class="space-y-1"></div>
        <div id="historyEmpty" class="text-center py-8 text-sm text-[--text-muted] hidden">No history yet.</div>
    </div>
</div>

<!-- Shortcuts Modal -->
<div id="modal-shortcuts" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4" onclick="if(event.target===this)closeModal('modal-shortcuts')">
    <div class="glass-card rounded-2xl p-6 w-full max-w-md scale-in">
        <div class="flex justify-between items-center mb-5">
            <h3 class="text-lg font-bold">‚å®Ô∏è Keyboard Shortcuts</h3>
            <button onclick="closeModal('modal-shortcuts')" class="text-[--text-secondary] hover:text-white transition p-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="space-y-2">
            <div class="flex justify-between items-center bg-[--bg-primary] rounded-lg px-3 py-2.5"><span class="text-sm">Copy password</span><div class="flex gap-1"><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">Ctrl</kbd><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">Shift</kbd><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">C</kbd></div></div>
            <div class="flex justify-between items-center bg-[--bg-primary] rounded-lg px-3 py-2.5"><span class="text-sm">New random password</span><div class="flex gap-1"><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">Ctrl</kbd><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">Shift</kbd><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">G</kbd></div></div>
            <div class="flex justify-between items-center bg-[--bg-primary] rounded-lg px-3 py-2.5"><span class="text-sm">Switch tabs (1-6)</span><div class="flex gap-1"><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">Alt</kbd><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">1-6</kbd></div></div>
            <div class="flex justify-between items-center bg-[--bg-primary] rounded-lg px-3 py-2.5"><span class="text-sm">Lock vault</span><div class="flex gap-1"><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">Ctrl</kbd><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">L</kbd></div></div>
            <div class="flex justify-between items-center bg-[--bg-primary] rounded-lg px-3 py-2.5"><span class="text-sm">Close modal / Escape</span><kbd class="mono text-xs bg-[--bg-card] border border-[--border] px-2 py-1 rounded">Esc</kbd></div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="mainFooter" class="border-t border-[--border] mt-12 py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <div class="flex items-center justify-center gap-2 mb-2">
            <div class="w-6 h-6 rounded-lg bg-gradient-to-br from-[--accent] to-[--accent-dark] flex items-center justify-center">
                <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
            </div>
            <span class="font-bold text-sm">KeyForge <span class="text-[--accent]">Pro</span></span>
            <span class="text-[0.55rem] text-[--warning] font-bold bg-[--warning]/10 px-1.5 py-0.5 rounded">AES-256</span>
        </div>
        <p class="text-xs text-[--text-muted] mb-1">v3.0 ‚Äî 100% Offline & Open Source ‚Äî AES-256-GCM Encrypted</p>
        <p class="text-xs text-[--text-muted] mb-3">Crafted with ‚ù§Ô∏è by <strong class="text-[--accent-light]">Sudhir Kumar</strong> (<span class="mono text-[--accent]">@SudhirDevOps1</span>)</p>
        <div class="flex justify-center gap-4">
            <button onclick="showClearAllModal()" class="text-xs text-[--danger]/50 hover:text-[--danger] transition">Clear All</button>
            <span class="text-[--border]">|</span>
            <button onclick="showInfo()" class="text-xs text-[--text-muted] hover:text-white transition">About</button>
            <span class="text-[--border]">|</span>
            <button onclick="showShortcuts()" class="text-xs text-[--text-muted] hover:text-white transition">Shortcuts</button>
        </div>
    </div>
</footer>

<script>
// ===== WORD LIST (350 EFF-inspired words) =====
const WORD_LIST=["apple","arrow","badge","baker","beach","beast","birth","blade","blaze","block","bloom","board","bonus","brave","brick","brief","broad","brush","burst","cabin","camel","candy","cargo","cedar","chain","chalk","charm","chase","chess","chief","cider","civil","claim","clash","clean","clear","clerk","cliff","climb","clock","cloud","coach","coast","coral","couch","craft","crane","crash","cream","crest","crisp","crown","crush","curve","dance","delta","depot","draft","drain","dream","drift","drive","drone","eagle","earth","ember","epoch","equal","event","extra","fable","fancy","feast","fiber","field","flame","flash","fleet","float","flood","floor","flora","flute","focus","forge","forum","frost","fruit","ghost","giant","glade","gleam","globe","gloom","grace","grain","grand","grape","grasp","grass","grave","grind","grove","guard","guide","haven","heart","hedge","hoist","honor","house","human","humor","ivory","jewel","joint","judge","juice","karma","kayak","knack","knife","knock","lance","laser","latch","layer","lemon","lever","light","lunar","magic","major","manor","maple","march","match","medal","mercy","metal","minor","mirth","model","money","moose","moral","mount","music","noble","north","novel","nurse","ocean","olive","onset","opera","orbit","outer","oxide","panel","paper","patch","pearl","phase","piano","pilot","pixel","place","plain","plant","plaza","plume","plush","point","polar","pound","power","press","price","pride","prime","print","prior","prize","proof","prose","proud","pulse","purse","quake","quest","quiet","quota","radar","radio","raise","range","rapid","raven","reach","rebel","reign","rider","rigid","rival","river","robin","robot","rocky","rouge","round","royal","rural","saint","scale","scene","scope","scout","share","sharp","shelf","shell","shift","shine","shire","shock","shore","sight","sigma","silk","siren","skill","slate","slice","slope","smart","smile","smoke","snake","solar","solid","sonic","south","space","spark","spear","speed","spent","spice","spine","spoke","spray","squad","stack","staff","stage","stair","stake","stamp","stand","stark","start","state","steam","steel","steep","steer","stern","stick","stock","stone","storm","story","stove","strap","straw","strip","study","style","sugar","suite","surge","swamp","sweep","swift","swing","sword","table","thorn","tiger","toast","token","topic","total","touch","tower","trace","track","trade","trail","train","trait","trend","trial","tribe","trick","troop","trout","trunk","trust","tunic","ultra","unity","upper","urban","usage","valid","value","valve","vapor","vault","verse","vigor","vinyl","viola","virus","visit","vital","vivid","vocal","voice","watch","water","whale","wheat","wheel","whole","width","witch","world","wound","wrist","xenon","yacht","yield","youth","zebra","zones"];

// ===== STATE =====
let vault = JSON.parse(localStorage.getItem('keyforge_vault') || '[]');
let history = JSON.parse(localStorage.getItem('keyforge_history') || '[]');
let masterKeyHash = localStorage.getItem('keyforge_mk_hash') || null;
let currentSeparator = '-';
let currentSymbol = '@';
let ppSeparator = '-';
let passwordVisible = true;
let currentPassword = '';
let currentPassphrase = '';
let currentRandomPw = '';
let deleteTargetId = null;
let isVaultLocked = false;
let sessionMasterKey = null; // stored in memory only during session
let autoLockTimer = null;

// ===== ENCRYPTION ENGINE (AES-256-GCM + PBKDF2) =====
function arrayToBase64(arr) {
    let binary=''; const bytes=new Uint8Array(arr);
    for(let i=0;i<bytes.byteLength;i++) binary+=String.fromCharCode(bytes[i]);
    return btoa(binary);
}
function base64ToArray(b64) {
    const binary=atob(b64); const bytes=new Uint8Array(binary.length);
    for(let i=0;i<binary.length;i++) bytes[i]=binary.charCodeAt(i);
    return bytes;
}

async function hashKey(key) {
    const enc = new TextEncoder();
    const hash = await crypto.subtle.digest('SHA-256', enc.encode(key));
    return arrayToBase64(new Uint8Array(hash));
}

async function deriveKey(password, salt) {
    const enc = new TextEncoder();
    const keyMaterial = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveBits','deriveKey']);
    return crypto.subtle.deriveKey(
        { name:'PBKDF2', salt, iterations:100000, hash:'SHA-256' },
        keyMaterial,
        { name:'AES-GCM', length:256 },
        false,
        ['encrypt','decrypt']
    );
}

async function encryptData(data, password) {
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const key = await deriveKey(password, salt);
    const enc = new TextEncoder();
    const encrypted = await crypto.subtle.encrypt({ name:'AES-GCM', iv }, key, enc.encode(JSON.stringify(data)));
    return {
        encrypted: true,
        algorithm: 'AES-256-GCM',
        kdf: 'PBKDF2-SHA256-100K',
        salt: arrayToBase64(salt),
        iv: arrayToBase64(iv),
        data: arrayToBase64(new Uint8Array(encrypted)),
        timestamp: new Date().toISOString()
    };
}

async function decryptData(encObj, password) {
    try {
        const salt = base64ToArray(encObj.salt);
        const iv = base64ToArray(encObj.iv);
        const data = base64ToArray(encObj.data);
        const key = await deriveKey(password, salt);
        const decrypted = await crypto.subtle.decrypt({ name:'AES-GCM', iv }, key, data);
        return { success:true, data:JSON.parse(new TextDecoder().decode(decrypted)) };
    } catch(e) {
        return { success:false, error:'Decryption failed ‚Äî wrong key or corrupted data' };
    }
}

// ===== MASTER KEY MANAGEMENT =====
async function setMasterKey() {
    const newKey = document.getElementById('mkNewKey').value;
    const confirm = document.getElementById('mkConfirmKey').value;
    const errEl = document.getElementById('mkError');
    
    if (newKey.length < 6) { errEl.textContent='Master key must be at least 6 characters'; errEl.classList.remove('hidden'); return; }
    if (newKey !== confirm) { errEl.textContent='Keys do not match'; errEl.classList.remove('hidden'); return; }
    
    errEl.classList.add('hidden');
    masterKeyHash = await hashKey(newKey);
    sessionMasterKey = newKey;
    localStorage.setItem('keyforge_mk_hash', masterKeyHash);
    
    updateMasterKeyUI();
    showToast('üîê Master Key set! Encryption enabled.','success');
    document.getElementById('mkNewKey').value='';
    document.getElementById('mkConfirmKey').value='';
    document.getElementById('mkStrengthBar').style.width='0%';
    document.getElementById('mkStrengthText').textContent='';
    setupAutoLock();
}

async function removeMasterKey() {
    masterKeyHash = null;
    sessionMasterKey = null;
    localStorage.removeItem('keyforge_mk_hash');
    updateMasterKeyUI();
    showToast('Master key removed','warning');
}

function checkMasterKeyStrength() {
    const pw = document.getElementById('mkNewKey').value;
    const s = calcStrength(pw);
    document.getElementById('mkStrengthBar').style.width = s.pct + '%';
    document.getElementById('mkStrengthBar').style.background = s.color;
    document.getElementById('mkStrengthText').textContent = pw ? `${s.label} ‚Äî ${s.entropy} bits entropy` : '';
}

function updateMasterKeyUI() {
    const hasMK = !!masterKeyHash;
    // Status section
    const statusIcon = document.getElementById('mkStatusIcon');
    const statusText = document.getElementById('mkStatusText');
    const statusSub = document.getElementById('mkStatusSub');
    
    if (hasMK) {
        statusIcon.className = 'w-10 h-10 rounded-xl flex items-center justify-center bg-[--success]/15';
        statusIcon.innerHTML = '<svg class="w-5 h-5 text-[--success]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>';
        statusText.textContent = 'Master Key Active';
        statusText.className = 'text-sm font-bold text-[--success]';
        statusSub.textContent = 'AES-256-GCM encryption enabled for exports';
        document.getElementById('mkSetTitle').textContent = 'üîÑ Change Master Key';
        document.getElementById('mkSetBtnText').textContent = 'Change Master Key';
        document.getElementById('mkRemoveSection').classList.remove('hidden');
    } else {
        statusIcon.className = 'w-10 h-10 rounded-xl flex items-center justify-center bg-[--danger]/15';
        statusIcon.innerHTML = '<svg class="w-5 h-5 text-[--danger]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>';
        statusText.textContent = 'No Master Key Set';
        statusText.className = 'text-sm font-bold text-[--danger]';
        statusSub.textContent = 'Set a master key to enable encryption';
        document.getElementById('mkSetTitle').textContent = 'üîë Set Master Key';
        document.getElementById('mkSetBtnText').textContent = 'Set Master Key';
        document.getElementById('mkRemoveSection').classList.add('hidden');
    }

    // Header badges
    document.getElementById('encryptionBadge').classList.toggle('hidden', !hasMK);
    document.getElementById('masterKeyDot').classList.toggle('hidden', hasMK);
    document.getElementById('lockBtn').classList.toggle('hidden', !hasMK);
    document.getElementById('heroCryptoBadge').classList.toggle('hidden', !hasMK);
    document.getElementById('stat-encrypted').textContent = hasMK ? 'ON' : 'OFF';
    document.getElementById('stat-encrypted').style.color = hasMK ? 'var(--success)' : 'var(--danger)';

    // Export options
    const expEnc = document.getElementById('exportEncrypted');
    const expStatus = document.getElementById('exportEncryptStatus');
    const customSection = document.getElementById('exportCustomKeySection');
    if (hasMK) {
        expEnc.disabled = false;
        expEnc.checked = true;
        expStatus.textContent = 'Encrypt with your master key';
        customSection.classList.remove('hidden');
    } else {
        expEnc.disabled = true;
        expEnc.checked = false;
        expStatus.textContent = 'Set master key first to enable';
        customSection.classList.add('hidden');
    }
}

function toggleMKVis(id) {
    const inp = document.getElementById(id);
    inp.type = inp.type === 'password' ? 'text' : 'password';
}

// ===== LOCK / UNLOCK =====
function lockVaultAction() {
    if (!masterKeyHash) { showToast('Set a master key first','warning'); return; }
    isVaultLocked = true;
    sessionMasterKey = null;
    document.getElementById('lockScreen').classList.remove('hidden');
    document.getElementById('lockScreen').classList.add('flex');
    document.getElementById('mainHeader').style.display = 'none';
    document.getElementById('mainContent').style.display = 'none';
    document.getElementById('mainFooter').style.display = 'none';
    document.getElementById('unlockKeyInput').value = '';
    document.getElementById('unlockError').classList.add('hidden');
    document.getElementById('unlockKeyInput').focus();
}

async function unlockVault() {
    const key = document.getElementById('unlockKeyInput').value;
    if (!key) return;
    
    const keyHash = await hashKey(key);
    if (keyHash === masterKeyHash) {
        isVaultLocked = false;
        sessionMasterKey = key;
        document.getElementById('lockScreen').classList.add('hidden');
        document.getElementById('lockScreen').classList.remove('flex');
        document.getElementById('mainHeader').style.display = '';
        document.getElementById('mainContent').style.display = '';
        document.getElementById('mainFooter').style.display = '';
        document.getElementById('unlockError').classList.add('hidden');
        showToast('üîì Vault unlocked!','success');
        setupAutoLock();
    } else {
        document.getElementById('unlockError').classList.remove('hidden');
        document.getElementById('unlockKeyInput').value = '';
        document.getElementById('unlockKeyInput').focus();
    }
}

function toggleUnlockVis() {
    const inp = document.getElementById('unlockKeyInput');
    inp.type = inp.type === 'password' ? 'text' : 'password';
}

function setupAutoLock() {
    if (autoLockTimer) clearTimeout(autoLockTimer);
    if (masterKeyHash) {
        autoLockTimer = setTimeout(() => {
            if (masterKeyHash && !isVaultLocked) lockVaultAction();
        }, 15 * 60 * 1000); // 15 minutes
    }
}

// Reset auto-lock on activity
document.addEventListener('click', () => { if(masterKeyHash && !isVaultLocked) setupAutoLock(); });
document.addEventListener('keydown', () => { if(masterKeyHash && !isVaultLocked) setupAutoLock(); });

// ===== INIT =====
document.addEventListener('DOMContentLoaded', () => {
    updateStats();
    renderVault();
    generatePassword();
    generatePassphrase();
    generateRandom();
    updateHistoryBadge();
    updateMasterKeyUI();
});

// ===== TAB SWITCHING =====
function switchTab(tab) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
    document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
    const content = document.getElementById('tab-' + tab);
    if (content) { content.classList.remove('hidden'); content.classList.add('slide-up'); }
    const btn = document.querySelector(`[data-tab="${tab}"]`);
    if (btn) btn.classList.add('active');
    if (tab === 'vault') renderVault();
}

// ===== SEPARATOR & SYMBOL =====
function selectSeparator(sep) {
    currentSeparator = sep;
    document.querySelectorAll('[data-sep]').forEach(el => el.classList.toggle('selected', el.dataset.sep === sep));
    generatePassword();
}
function selectSymbol(sym) {
    currentSymbol = sym;
    document.querySelectorAll('[data-sym]').forEach(el => el.classList.toggle('selected', el.dataset.sym === sym));
    generatePassword();
}
function selectPPSep(sep) {
    ppSeparator = sep;
    document.querySelectorAll('[data-ppsep]').forEach(el => el.classList.toggle('selected', el.dataset.ppsep === sep));
    generatePassphrase();
}

// ===== QUICK FILL =====
function quickFill(name) {
    document.getElementById('siteName').value = name;
    document.getElementById('siteShort').value = generateAbbr(name);
    const catMap = {'Google':'email','Gmail':'email','Instagram':'social','Facebook':'social','Twitter':'social','GitHub':'dev','Amazon':'shopping','Netflix':'entertainment','Discord':'gaming','LinkedIn':'work','Spotify':'entertainment'};
    if (catMap[name]) document.getElementById('category').value = catMap[name];
    generatePassword();
}
function generateAbbr(name) {
    if (!name) return '';
    const n = name.trim();
    if (n.length <= 4) return n.charAt(0).toUpperCase() + n.slice(1).toLowerCase();
    const abbrs = {'instagram':'Insta','facebook':'Face','twitter':'Twit','youtube':'YT','linkedin':'Lnkd','snapchat':'Snap','pinterest':'Pin','reddit':'Rdit','tiktok':'TkTk','whatsapp':'WApp','telegram':'Tele','discord':'Disc','github':'GHub','google':'Goog','gmail':'Gma','amazon':'Amzn','netflix':'Nflx','spotify':'Spot','microsoft':'Msft','apple':'Appl'};
    const lower = n.toLowerCase();
    if (abbrs[lower]) return abbrs[lower];
    return n.charAt(0).toUpperCase() + n.slice(1, 4);
}

// ===== FORMULA PASSWORD =====
function generatePassword() {
    const base = document.getElementById('baseWord').value.trim();
    const site = document.getElementById('siteName').value.trim();
    const year = document.getElementById('yearNum').value.trim();
    let short = document.getElementById('siteShort').value.trim();
    if (!short && site) { short = generateAbbr(site); document.getElementById('siteShort').value = short; }
    if (!base && !short) {
        document.getElementById('passwordPreview').innerHTML = '<span class="text-[--text-muted] text-base font-normal">Fill the fields to generate...</span>';
        document.getElementById('formulaBreakdown').classList.add('hidden');
        resetStats('charCount','upperCount','specialCount','entropyBits');
        document.getElementById('strengthBar').style.width = '0%';
        document.getElementById('strengthLabel').textContent = '‚Äî';
        document.getElementById('crackTime').textContent = '';
        currentPassword = '';
        return;
    }
    const parts = [base, currentSeparator, short, currentSymbol, year].filter(p => p !== '');
    currentPassword = parts.join('');
    displayPassword('passwordPreview', currentPassword, passwordVisible);
    showFormulaBreakdown(base, currentSeparator, short, currentSymbol, year);
    updatePasswordStats(currentPassword, 'charCount', 'upperCount', 'specialCount', 'entropyBits', 'strengthBar', 'strengthLabel', 'crackTime');
}
function displayPassword(elId, pw, visible) { document.getElementById(elId).textContent = visible ? pw : '‚Ä¢'.repeat(pw.length); }
function showFormulaBreakdown(base, sep, short, sym, year) {
    const fp = document.getElementById('formulaParts');
    fp.innerHTML = '';
    const colors = ['bg-green-500/20 text-green-400','bg-yellow-500/20 text-yellow-400','bg-blue-500/20 text-blue-400','bg-red-500/20 text-red-400','bg-purple-500/20 text-purple-400'];
    const vals = [base,sep,short,sym,year]; let first=true;
    vals.forEach((v,i)=>{if(v){if(!first){const p=document.createElement('span');p.className='text-[--text-muted] text-xs mx-0.5';p.textContent='+';fp.appendChild(p);}const s=document.createElement('span');s.className=`${colors[i]} px-2 py-1 rounded text-xs font-semibold`;s.textContent=v;fp.appendChild(s);first=false;}});
    document.getElementById('formulaBreakdown').classList.remove('hidden');
}
function resetStats(...ids) { ids.forEach(id=>{const el=document.getElementById(id);if(el)el.textContent='0';}); }

// ===== STRENGTH CALC =====
function calcStrength(pw) {
    if (!pw) return {score:0,label:'None',color:'#555',pct:0,entropy:0,charset:0,crackTime:'',level:'weak'};
    let charset=0;
    if(/[a-z]/.test(pw))charset+=26;if(/[A-Z]/.test(pw))charset+=26;if(/[0-9]/.test(pw))charset+=10;if(/[^a-zA-Z0-9]/.test(pw))charset+=33;
    const entropy=Math.round(pw.length*Math.log2(charset||1));
    let score=0;
    if(pw.length>=8)score++;if(pw.length>=12)score++;if(pw.length>=16)score++;if(pw.length>=20)score++;
    if(/[a-z]/.test(pw)&&/[A-Z]/.test(pw))score++;if(/[0-9]/.test(pw))score++;if(/[^a-zA-Z0-9]/.test(pw))score++;
    if(entropy>=40)score++;if(entropy>=60)score++;if(entropy>=80)score++;
    let pct,color,label;
    if(score<=2){pct=15;color='#ef4444';label='Weak';}else if(score<=4){pct=35;color='#f59e0b';label='Fair';}else if(score<=6){pct=60;color='#22c55e';label='Strong';}else if(score<=8){pct=85;color='#6c63ff';label='Very Strong';}else{pct=100;color='#a78bfa';label='Excellent';}
    const gps=1e10;const tot=Math.pow(charset||1,pw.length);const sec=tot/gps/2;
    let crackTime='';
    if(sec<1)crackTime='Instantly';else if(sec<60)crackTime=Math.round(sec)+'s';else if(sec<3600)crackTime=Math.round(sec/60)+'m';else if(sec<86400)crackTime=Math.round(sec/3600)+'h';else if(sec<31536000)crackTime=Math.round(sec/86400)+'d';else if(sec<31536000*1e3)crackTime=Math.round(sec/31536000)+'y';else if(sec<31536000*1e6)crackTime=Math.round(sec/31536000/1e3)+'K years';else if(sec<31536000*1e9)crackTime=Math.round(sec/31536000/1e6)+'M years';else crackTime='‚àû (centuries+)';
    const level=score<=2?'weak':score<=4?'medium':'strong';
    return {score,label,color,pct,entropy,charset,crackTime,level};
}
function updatePasswordStats(pw,lenId,upperId,specId,entrId,barId,labelId,crackId) {
    const el=(id)=>document.getElementById(id);
    el(lenId).textContent=pw.length;if(upperId)el(upperId).textContent=(pw.match(/[A-Z]/g)||[]).length;
    el(specId).textContent=(pw.match(/[^a-zA-Z0-9]/g)||[]).length;
    const s=calcStrength(pw);el(entrId).textContent=s.entropy;
    el(barId).style.width=s.pct+'%';el(barId).style.background=s.color;
    el(labelId).textContent=s.label;el(labelId).style.color=s.color;
    if(crackId)el(crackId).textContent=s.crackTime?`‚è± ${s.crackTime}`:'';
}
function getStrengthLevel(pw){return calcStrength(pw).level;}

// ===== VISIBILITY =====
function togglePasswordVisibility(){passwordVisible=!passwordVisible;document.getElementById('toggleVisBtn').querySelector('span').textContent=passwordVisible?'Hide':'Show';generatePassword();}

// ===== COPY =====
function copyPassword(){if(!currentPassword){showToast('No password','warning');return;}navigator.clipboard.writeText(currentPassword).then(()=>{showToast('Password copied!','success');addToHistory(currentPassword,'Formula');});}

// ===== PASSPHRASE =====
function generatePassphrase() {
    const count=parseInt(document.getElementById('ppWordCount').value);
    const capitalize=document.getElementById('ppCapitalize').checked;
    const addNum=document.getElementById('ppAddNumber').checked;
    const addSym=document.getElementById('ppAddSymbol').checked;
    const l33t=document.getElementById('ppL33t').checked;
    let words=[];const used=new Set();
    for(let i=0;i<count;i++){let idx;do{idx=cryptoRandInt(WORD_LIST.length);}while(used.has(idx));used.add(idx);let w=WORD_LIST[idx];if(capitalize)w=w.charAt(0).toUpperCase()+w.slice(1);if(l33t)w=toLeet(w);words.push(w);}
    let pp=words.join(ppSeparator);if(addNum)pp+=cryptoRandInt(900)+100;if(addSym){const syms='!@#$%&*?';pp+=syms[cryptoRandInt(syms.length)];}
    currentPassphrase=pp;
    document.getElementById('passphrasePreview').textContent=pp;
    const wordColors=['bg-green-500/20 text-green-400','bg-blue-500/20 text-blue-400','bg-purple-500/20 text-purple-400','bg-yellow-500/20 text-yellow-400','bg-red-500/20 text-red-400','bg-cyan-500/20 text-cyan-400','bg-pink-500/20 text-pink-400','bg-orange-500/20 text-orange-400'];
    document.getElementById('ppWords').innerHTML=words.map((w,i)=>`<span class="passphrase-word ${wordColors[i%wordColors.length]} text-xs">${escapeHTML(w)}</span>`).join('');
    document.getElementById('ppCharCount').textContent=pp.length;document.getElementById('ppWordTotal').textContent=count;
    const s=calcStrength(pp);document.getElementById('ppEntropy').textContent=s.entropy;
    document.getElementById('ppStrengthBar').style.width=s.pct+'%';document.getElementById('ppStrengthBar').style.background=s.color;
    document.getElementById('ppStrengthLabel').textContent=s.label;document.getElementById('ppStrengthLabel').style.color=s.color;
    document.getElementById('ppCrackTime').textContent=s.crackTime?`‚è± ${s.crackTime}`:'';
}
function toLeet(str){const map={'a':'4','e':'3','i':'1','o':'0','s':'5','t':'7','l':'1'};return str.split('').map(c=>Math.random()>0.6&&map[c.toLowerCase()]?map[c.toLowerCase()]:c).join('');}
function cryptoRandInt(max){const arr=new Uint32Array(1);crypto.getRandomValues(arr);return arr[0]%max;}
function copyPassphrase(){if(!currentPassphrase){showToast('Generate first','warning');return;}navigator.clipboard.writeText(currentPassphrase).then(()=>{showToast('Passphrase copied!','success');addToHistory(currentPassphrase,'Passphrase');});}
function savePassphraseToVault(){
    if(!currentPassphrase){showToast('Generate first','warning');return;}
    const site=document.getElementById('ppSiteName').value.trim()||'Passphrase';
    vault.unshift({id:genId(),site,siteShort:'',baseWord:'[passphrase]',separator:'',symbol:'',year:'',password:currentPassphrase,category:'other',username:'',url:'',notes:'Passphrase generated',strength:getStrengthLevel(currentPassphrase),favorite:false,type:'passphrase',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});
    saveVault();updateStats();addToHistory(currentPassphrase,'Passphrase');showToast(`"${site}" saved!`,'success');document.getElementById('ppSiteName').value='';generatePassphrase();
}

// ===== RANDOM =====
function generateRandom(){
    const len=parseInt(document.getElementById('rpLength').value);
    let chars='';
    if(document.getElementById('rpUpper').checked)chars+='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    if(document.getElementById('rpLower').checked)chars+='abcdefghijklmnopqrstuvwxyz';
    if(document.getElementById('rpNumbers').checked)chars+='0123456789';
    if(document.getElementById('rpSymbols').checked)chars+='!@#$%^&*()_+-=';
    if(document.getElementById('rpExcludeAmbiguous').checked)chars=chars.replace(/[0OoIl1|]/g,'');
    if(!chars)chars='abcdefghijklmnopqrstuvwxyz';
    let pw='';const arr=new Uint32Array(len);crypto.getRandomValues(arr);
    for(let i=0;i<len;i++)pw+=chars[arr[i]%chars.length];
    currentRandomPw=pw;document.getElementById('randomPreview').textContent=pw;
    document.getElementById('rpCharCount').textContent=pw.length;document.getElementById('rpSpecCount').textContent=(pw.match(/[^a-zA-Z0-9]/g)||[]).length;
    const s=calcStrength(pw);document.getElementById('rpEntropyBits').textContent=s.entropy;
    document.getElementById('rpStrengthBar').style.width=s.pct+'%';document.getElementById('rpStrengthBar').style.background=s.color;
    document.getElementById('rpStrengthLabel').textContent=s.label;document.getElementById('rpStrengthLabel').style.color=s.color;
    document.getElementById('rpCrackTime').textContent=s.crackTime?`‚è± ${s.crackTime}`:'';
}
function copyRandomPassword(){if(!currentRandomPw){showToast('Generate first','warning');return;}navigator.clipboard.writeText(currentRandomPw).then(()=>{showToast('Copied!','success');addToHistory(currentRandomPw,'Random');});}
function saveRandomToVault(){
    if(!currentRandomPw){showToast('Generate first','warning');return;}
    const site=document.getElementById('rpSiteName').value.trim()||'Random Password';
    vault.unshift({id:genId(),site,siteShort:'',baseWord:'[random]',separator:'',symbol:'',year:'',password:currentRandomPw,category:'other',username:'',url:'',notes:'Randomly generated',strength:getStrengthLevel(currentRandomPw),favorite:false,type:'random',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});
    saveVault();updateStats();addToHistory(currentRandomPw,'Random');showToast(`"${site}" saved!`,'success');document.getElementById('rpSiteName').value='';generateRandom();
}
function batchGenerate(){
    const count=parseInt(document.getElementById('batchCount').value);const len=parseInt(document.getElementById('rpLength').value);const container=document.getElementById('batchResults');container.innerHTML='';
    for(let i=0;i<count;i++){let chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';let pw='';const arr=new Uint32Array(len);crypto.getRandomValues(arr);for(let j=0;j<len;j++)pw+=chars[arr[j]%chars.length];
    const s=calcStrength(pw);const div=document.createElement('div');div.className='flex items-center gap-2 bg-[--bg-primary] rounded-lg px-3 py-2 cursor-pointer hover:bg-[--bg-card] transition';
    div.innerHTML=`<span class="w-2 h-2 rounded-full shrink-0" style="background:${s.color}"></span><span class="mono text-xs text-[--text-primary] flex-1 truncate select-all">${escapeHTML(pw)}</span><button onclick="event.stopPropagation();navigator.clipboard.writeText('${pw.replace(/'/g,"\\'")}');showToast('Copied!','success')" class="text-[--text-muted] hover:text-[--accent] transition p-1"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></button>`;
    container.appendChild(div);}
}

// ===== CHECKER =====
let checkerVisible=true;
function toggleCheckerVis(){checkerVisible=!checkerVisible;document.getElementById('checkerInput').type=checkerVisible?'text':'password';}
function analyzePassword(){
    const pw=document.getElementById('checkerInput').value;const results=document.getElementById('checkerResults');
    if(!pw){results.classList.add('hidden');return;}results.classList.remove('hidden');
    const s=calcStrength(pw);
    document.getElementById('ckLength').textContent=pw.length;document.getElementById('ckEntropy').textContent=s.entropy;
    document.getElementById('ckCharset').textContent=s.charset;document.getElementById('ckScore').textContent=Math.min(10,s.score);
    document.getElementById('ckStrengthBar').style.width=s.pct+'%';document.getElementById('ckStrengthBar').style.background=s.color;
    document.getElementById('ckStrengthLabel').textContent=s.label;document.getElementById('ckStrengthLabel').style.color=s.color;
    document.getElementById('ckCrackTime').textContent=`‚è± ${s.crackTime}`;
    const checks=[{test:pw.length>=8,label:'At least 8 characters'},{test:pw.length>=12,label:'At least 12 characters'},{test:/[a-z]/.test(pw),label:'Lowercase letters'},{test:/[A-Z]/.test(pw),label:'Uppercase letters'},{test:/[0-9]/.test(pw),label:'Numbers'},{test:/[^a-zA-Z0-9]/.test(pw),label:'Special characters'},{test:!/(.)\1{2,}/.test(pw),label:'No repeated chars (3+)'},{test:!/^(12345|password|qwerty|abc123)/i.test(pw),label:'Not a common password'}];
    document.getElementById('ckChecklist').innerHTML=checks.map(c=>`<div class="flex items-center gap-3 bg-[--bg-primary] rounded-lg px-3 py-2.5"><span class="text-sm ${c.test?'text-[--success]':'text-[--danger]'}">${c.test?'‚úì':'‚úó'}</span><span class="text-sm flex-1 ${c.test?'text-[--text-primary]':'text-[--text-secondary]'}">${c.label}</span></div>`).join('');
    const upper=(pw.match(/[A-Z]/g)||[]).length,lower=(pw.match(/[a-z]/g)||[]).length,nums=(pw.match(/[0-9]/g)||[]).length,spec=(pw.match(/[^a-zA-Z0-9]/g)||[]).length;
    document.getElementById('ckComposition').innerHTML=`<div class="text-center"><div class="text-lg font-bold text-blue-400">${upper}</div><div class="text-[0.55rem] text-[--text-muted]">Upper</div></div><div class="text-center"><div class="text-lg font-bold text-green-400">${lower}</div><div class="text-[0.55rem] text-[--text-muted]">Lower</div></div><div class="text-center"><div class="text-lg font-bold text-yellow-400">${nums}</div><div class="text-[0.55rem] text-[--text-muted]">Numbers</div></div><div class="text-center"><div class="text-lg font-bold text-red-400">${spec}</div><div class="text-[0.55rem] text-[--text-muted]">Special</div></div>`;
}

// ===== SAVE TO VAULT =====
function saveToVault(){
    const base=document.getElementById('baseWord').value.trim();const site=document.getElementById('siteName').value.trim();
    if(!base||!site){showToast('Fill Base Word and Site Name','warning');return;}if(!currentPassword){showToast('No password','warning');return;}
    vault.unshift({id:genId(),site,siteShort:document.getElementById('siteShort').value.trim(),baseWord:base,separator:currentSeparator,symbol:currentSymbol,year:document.getElementById('yearNum').value.trim(),password:currentPassword,category:document.getElementById('category').value,username:document.getElementById('username').value.trim(),url:document.getElementById('siteUrl').value.trim(),notes:document.getElementById('notes').value.trim(),strength:getStrengthLevel(currentPassword),favorite:false,type:'formula',createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});
    saveVault();updateStats();addToHistory(currentPassword,'Formula');showToast(`"${site}" saved!`,'success');
    document.getElementById('siteName').value='';document.getElementById('siteShort').value='';document.getElementById('username').value='';document.getElementById('siteUrl').value='';document.getElementById('notes').value='';generatePassword();
}
function genId(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7);}
function saveVault(){localStorage.setItem('keyforge_vault',JSON.stringify(vault));document.getElementById('vault-count').textContent=vault.length;}

// ===== HISTORY =====
function addToHistory(pw,type){history.unshift({password:pw,type,time:new Date().toISOString()});if(history.length>50)history=history.slice(0,50);localStorage.setItem('keyforge_history',JSON.stringify(history));updateHistoryBadge();}
function updateHistoryBadge(){const badge=document.getElementById('history-badge');if(history.length>0){badge.textContent=history.length;badge.classList.remove('hidden');}else badge.classList.add('hidden');}
function showHistory(){
    const list=document.getElementById('historyList');const empty=document.getElementById('historyEmpty');
    if(history.length===0){list.innerHTML='';empty.classList.remove('hidden');}
    else{empty.classList.add('hidden');const tc={Formula:'text-[--accent-light]',Passphrase:'text-[--success]',Random:'text-[--warning]'};
    list.innerHTML=history.map(h=>{const t=new Date(h.time).toLocaleString('en-US',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});return`<div class="history-item flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer" onclick="navigator.clipboard.writeText('${h.password.replace(/'/g,"\\'")}');showToast('Copied!','success')"><span class="text-[0.6rem] font-bold ${tc[h.type]||'text-[--text-muted]'} w-16 shrink-0">${h.type}</span><span class="mono text-xs text-[--text-primary] flex-1 truncate">${escapeHTML(h.password)}</span><span class="text-[0.55rem] text-[--text-muted] shrink-0">${t}</span></div>`;}).join('');}
    openModal('modal-history');
}
function clearHistory(){history=[];localStorage.setItem('keyforge_history',JSON.stringify(history));updateHistoryBadge();showHistory();showToast('History cleared','success');}

// ===== STATS =====
function updateStats(){
    document.getElementById('stat-total').textContent=vault.length;document.getElementById('vault-count').textContent=vault.length;
    let strong=0,medium=0,weak=0,favs=0;
    vault.forEach(e=>{const s=e.strength||getStrengthLevel(e.password);if(s==='strong')strong++;else if(s==='medium')medium++;else weak++;if(e.favorite)favs++;});
    document.getElementById('stat-strong').textContent=strong;document.getElementById('stat-medium').textContent=medium;
    document.getElementById('stat-weak').textContent=weak;document.getElementById('stat-favs').textContent=favs;
}

// ===== RENDER VAULT =====
function renderVault(){
    const search=(document.getElementById('searchVault')?.value||'').toLowerCase();const catFilter=document.getElementById('filterCategory')?.value||'all';const sort=document.getElementById('sortBy')?.value||'newest';
    let filtered=vault.filter(e=>{const ms=!search||e.site.toLowerCase().includes(search)||(e.username||'').toLowerCase().includes(search)||e.category.toLowerCase().includes(search);let mc=catFilter==='all'||e.category===catFilter;if(catFilter==='favorites')mc=e.favorite;return ms&&mc;});
    filtered.sort((a,b)=>{switch(sort){case'newest':return new Date(b.createdAt)-new Date(a.createdAt);case'oldest':return new Date(a.createdAt)-new Date(b.createdAt);case'name':return a.site.localeCompare(b.site);case'name-desc':return b.site.localeCompare(a.site);case'strength':const o={strong:0,medium:1,weak:2};return(o[a.strength]||2)-(o[b.strength]||2);default:return 0;}});
    const list=document.getElementById('vaultList');const empty=document.getElementById('vaultEmpty');
    if(filtered.length===0){list.innerHTML='';empty.classList.remove('hidden');return;}empty.classList.add('hidden');
    const cc={social:'bg-blue-500/20 text-blue-400',email:'bg-green-500/20 text-green-400',finance:'bg-yellow-500/20 text-yellow-400',work:'bg-purple-500/20 text-purple-400',shopping:'bg-pink-500/20 text-pink-400',dev:'bg-cyan-500/20 text-cyan-400',gaming:'bg-orange-500/20 text-orange-400',entertainment:'bg-rose-500/20 text-rose-400',education:'bg-teal-500/20 text-teal-400',other:'bg-gray-500/20 text-gray-400'};
    const cl={social:'Social',email:'Email',finance:'Finance',work:'Work',shopping:'Shop',dev:'Dev',gaming:'Gaming',entertainment:'Fun',education:'Edu',other:'Other'};
    const si={strong:'<span class="text-[--success] text-[0.6rem] font-bold">‚óè Strong</span>',medium:'<span class="text-[--warning] text-[0.6rem] font-bold">‚óè Medium</span>',weak:'<span class="text-[--danger] text-[0.6rem] font-bold">‚óè Weak</span>'};
    const icons={google:'üîç',gmail:'üìß',instagram:'üì∏',facebook:'üë§',twitter:'üê¶',github:'üíª',amazon:'üì¶',netflix:'üé¨',spotify:'üéµ',youtube:'‚ñ∂Ô∏è',linkedin:'üíº',discord:'üéÆ'};
    list.innerHTML=filtered.map(entry=>{
        const icon=icons[entry.site.toLowerCase()]||(entry.type==='passphrase'?'üé≤':entry.type==='random'?'üé∞':'üîë');
        const catC=cc[entry.category]||cc.other;const catL=cl[entry.category]||'Other';const str=si[entry.strength||'weak'];
        const date=new Date(entry.createdAt).toLocaleDateString('en-US',{month:'short',day:'numeric'});const mp='‚Ä¢'.repeat(Math.min(entry.password.length,20));const age=getAge(entry.createdAt);
        return`<div class="vault-item bg-[--bg-card] rounded-xl p-4 cursor-pointer" onclick="viewEntry('${entry.id}')"><div class="flex items-start gap-3"><div class="w-10 h-10 rounded-xl bg-[--bg-primary] flex items-center justify-center text-lg shrink-0">${icon}</div><div class="flex-1 min-w-0"><div class="flex items-center gap-1.5 mb-1 flex-wrap"><span class="fav-star ${entry.favorite?'active text-yellow-400':'text-[--text-muted]'}" onclick="event.stopPropagation();toggleFav('${entry.id}')">${entry.favorite?'‚òÖ':'‚òÜ'}</span><h4 class="font-bold text-sm">${escapeHTML(entry.site)}</h4><span class="category-badge ${catC}">${catL}</span>${str}</div>${entry.username?`<div class="text-[0.65rem] text-[--text-muted] truncate mb-0.5">${escapeHTML(entry.username)}</div>`:''}<div class="mono text-xs text-[--text-muted] tracking-wider">${mp}</div></div><div class="flex flex-col items-end gap-1 shrink-0"><div class="flex items-center gap-1"><button onclick="event.stopPropagation();copyEntryPw('${entry.id}')" class="p-1.5 rounded-lg hover:bg-[--bg-primary] transition text-[--text-muted] hover:text-[--accent]" title="Copy"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></button><button onclick="event.stopPropagation();showDeleteModal('${entry.id}')" class="p-1.5 rounded-lg hover:bg-[--bg-primary] transition text-[--text-muted] hover:text-[--danger]" title="Delete"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div><div class="text-[0.55rem] text-[--text-muted]">${date}</div><div class="text-[0.5rem] text-[--text-muted]">${age}</div></div></div></div>`;
    }).join('');
}
function getAge(d){const diff=Date.now()-new Date(d).getTime();const days=Math.floor(diff/86400000);if(days===0)return'Today';if(days===1)return'1d ago';if(days<30)return days+'d ago';if(days<365)return Math.floor(days/30)+'mo ago';return Math.floor(days/365)+'y ago';}
function toggleFav(id){const e=vault.find(v=>v.id===id);if(e){e.favorite=!e.favorite;saveVault();updateStats();renderVault();}}

// ===== VIEW ENTRY =====
function viewEntry(id){
    const entry=vault.find(e=>e.id===id);if(!entry)return;
    const catLabels={social:'Social Media',email:'Email',finance:'Finance/Banking',work:'Work/Office',shopping:'Shopping',dev:'Developer',gaming:'Gaming',entertainment:'Entertainment',education:'Education',other:'Other'};
    const s=calcStrength(entry.password);const escapedPw=escapeHTML(entry.password).replace(/'/g,"\\'");const escapedUser=escapeHTML(entry.username||'').replace(/'/g,"\\'");
    document.getElementById('viewEntryContent').innerHTML=`<div class="flex justify-between items-center mb-5"><h3 class="text-lg font-bold flex items-center gap-2"><span class="fav-star ${entry.favorite?'active text-yellow-400':'text-[--text-muted]'} text-xl" onclick="toggleFav('${entry.id}');viewEntry('${entry.id}')">${entry.favorite?'‚òÖ':'‚òÜ'}</span>${escapeHTML(entry.site)}</h3><button onclick="closeModal('modal-view')" class="text-[--text-secondary] hover:text-white transition p-1"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><div class="space-y-3"><div class="bg-[--bg-primary] rounded-xl p-4"><label class="text-[0.65rem] text-[--text-muted] block mb-1 font-semibold tracking-wider">PASSWORD</label><div class="flex items-center gap-2"><span class="mono text-[--accent-light] text-sm break-all flex-1 select-all font-semibold">${escapeHTML(entry.password)}</span><button onclick="navigator.clipboard.writeText('${escapedPw}');showToast('Copied!','success')" class="p-1.5 rounded-lg hover:bg-[--bg-card] transition text-[--text-muted] hover:text-[--accent]"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></button></div><div class="flex items-center gap-2 mt-2"><div class="flex-1 h-1.5 bg-[--bg-card] rounded-full overflow-hidden"><div class="h-full rounded-full" style="width:${s.pct}%;background:${s.color}"></div></div><span class="text-[0.6rem] font-bold" style="color:${s.color}">${s.label}</span></div><div class="text-[0.6rem] text-[--text-muted] mt-1">‚è± ${s.crackTime} ‚Ä¢ ${s.entropy} bits entropy</div></div>${entry.type==='formula'?`<div class="bg-[--bg-primary] rounded-xl p-4"><label class="text-[0.65rem] text-[--text-muted] block mb-1 font-semibold tracking-wider">FORMULA</label><div class="flex gap-1 flex-wrap mono text-xs"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">${escapeHTML(entry.baseWord)}</span>${entry.separator?`<span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded">${escapeHTML(entry.separator)}</span>`:''} ${entry.siteShort?`<span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded">${escapeHTML(entry.siteShort)}</span>`:''}<span class="bg-red-500/20 text-red-400 px-2 py-1 rounded">${escapeHTML(entry.symbol)}</span>${entry.year?`<span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">${escapeHTML(entry.year)}</span>`:''}</div></div>`:''} ${entry.username?`<div class="bg-[--bg-primary] rounded-xl p-4"><label class="text-[0.65rem] text-[--text-muted] block mb-1 font-semibold tracking-wider">USERNAME / EMAIL</label><div class="flex items-center gap-2"><span class="text-sm break-all flex-1">${escapeHTML(entry.username)}</span><button onclick="navigator.clipboard.writeText('${escapedUser}');showToast('Copied!','success')" class="p-1.5 rounded-lg hover:bg-[--bg-card] transition text-[--text-muted]"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></button></div></div>`:''}<div class="grid grid-cols-3 gap-2"><div class="bg-[--bg-primary] rounded-xl p-3 text-center"><label class="text-[0.55rem] text-[--text-muted] block mb-0.5">CATEGORY</label><span class="text-xs font-semibold">${catLabels[entry.category]||'Other'}</span></div><div class="bg-[--bg-primary] rounded-xl p-3 text-center"><label class="text-[0.55rem] text-[--text-muted] block mb-0.5">TYPE</label><span class="text-xs font-semibold capitalize">${entry.type||'formula'}</span></div><div class="bg-[--bg-primary] rounded-xl p-3 text-center"><label class="text-[0.55rem] text-[--text-muted] block mb-0.5">CREATED</label><span class="text-xs">${new Date(entry.createdAt).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</span></div></div>${entry.notes?`<div class="bg-[--bg-primary] rounded-xl p-4"><label class="text-[0.65rem] text-[--text-muted] block mb-1 font-semibold tracking-wider">NOTES</label><p class="text-sm whitespace-pre-wrap">${escapeHTML(entry.notes)}</p></div>`:''}</div><div class="flex gap-3 mt-5">${entry.type==='formula'?`<button onclick="loadEntryToEditor('${entry.id}')" class="btn-outline flex-1 rounded-xl py-2.5 text-sm font-bold text-[--text-secondary] flex items-center justify-center gap-2">‚úèÔ∏è Edit</button>`:'<div class="flex-1"></div>'}<button onclick="showDeleteModal('${entry.id}');closeModal('modal-view')" class="bg-[--danger]/15 text-[--danger] border border-[--danger]/25 hover:bg-[--danger]/25 rounded-xl px-4 py-2.5 text-sm font-bold transition flex items-center gap-2">üóëÔ∏è Delete</button></div>`;
    openModal('modal-view');
}
function loadEntryToEditor(id){
    const entry=vault.find(e=>e.id===id);if(!entry)return;closeModal('modal-view');switchTab('generator');
    document.getElementById('baseWord').value=entry.baseWord;document.getElementById('siteName').value=entry.site;document.getElementById('siteShort').value=entry.siteShort;document.getElementById('yearNum').value=entry.year;document.getElementById('category').value=entry.category;document.getElementById('username').value=entry.username||'';document.getElementById('siteUrl').value=entry.url||'';document.getElementById('notes').value=entry.notes||'';
    selectSeparator(entry.separator);selectSymbol(entry.symbol);generatePassword();
}
function copyEntryPw(id){const e=vault.find(v=>v.id===id);if(!e)return;navigator.clipboard.writeText(e.password).then(()=>showToast('Copied!','success'));}

// ===== DELETE =====
function showDeleteModal(id){deleteTargetId=id;openModal('modal-delete');}
function confirmDelete(){if(!deleteTargetId)return;vault=vault.filter(e=>e.id!==deleteTargetId);saveVault();updateStats();renderVault();closeModal('modal-delete');showToast('Deleted','success');deleteTargetId=null;}
function showClearAllModal(){if(vault.length===0&&history.length===0){showToast('Already empty','warning');return;}openModal('modal-clearall');}
function confirmClearAll(){vault=[];history=[];saveVault();localStorage.setItem('keyforge_history',JSON.stringify(history));updateStats();renderVault();updateHistoryBadge();closeModal('modal-clearall');showToast('All data cleared','success');}

// ===== IMPORT / EXPORT (ENCRYPTED) =====
function showImportExport(){openModal('modal-ie');}
function showMasterKeySettings(){openModal('modal-masterkey');}
function toggleCustomExportKey(){document.getElementById('customExportKeyInput').classList.toggle('hidden',!document.getElementById('useCustomExportKey').checked);}

async function exportJSON(){
    if(vault.length===0){showToast('Vault is empty','warning');return;}
    const shouldEncrypt=document.getElementById('exportEncrypted').checked;
    let exportData;
    
    if(shouldEncrypt){
        let encKey=sessionMasterKey;
        if(document.getElementById('useCustomExportKey')?.checked){
            const ck=document.getElementById('exportCustomKey').value;
            if(!ck){showToast('Enter a custom key','warning');return;}
            encKey=ck;
        }
        if(!encKey){
            showToast('Enter your master key to unlock first, or lock & unlock vault','warning');return;
        }
        try{
            const plainData={app:'KeyForge Pro',version:'3.0',author:'Sudhir Kumar (@SudhirDevOps1)',exportedAt:new Date().toISOString(),totalEntries:vault.length,entries:vault};
            exportData=await encryptData(plainData,encKey);
            exportData.app='KeyForge Pro';exportData.version='3.0';exportData.author='Sudhir Kumar (@SudhirDevOps1)';exportData.totalEntries=vault.length;
            showToast('üîê Exported with AES-256-GCM encryption!','success');
        }catch(err){showToast('Encryption failed: '+err.message,'danger');return;}
    } else {
        exportData={app:'KeyForge Pro',version:'3.0',author:'Sudhir Kumar (@SudhirDevOps1)',exportedAt:new Date().toISOString(),totalEntries:vault.length,encrypted:false,entries:vault};
        showToast('Exported (unencrypted)','success');
    }
    
    const blob=new Blob([JSON.stringify(exportData,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);const a=document.createElement('a');
    a.href=url;a.download=`keyforge-vault${shouldEncrypt?'-encrypted':''}-${new Date().toISOString().slice(0,10)}.json`;a.click();
    URL.revokeObjectURL(url);
}

function exportCSV(){
    if(vault.length===0){showToast('Vault is empty','warning');return;}
    let csv='Site,Username,Password,Category,Type,Strength,Created\n';
    vault.forEach(e=>{csv+=`"${e.site}","${e.username||''}","${e.password}","${e.category}","${e.type||'formula'}","${e.strength}","${e.createdAt}"\n`;});
    const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download=`keyforge-vault-${new Date().toISOString().slice(0,10)}.csv`;a.click();
    URL.revokeObjectURL(url);showToast('CSV exported!','success');
}

async function copyVaultJSON(){
    if(vault.length===0){showToast('Vault is empty','warning');return;}
    const data={app:'KeyForge Pro',version:'3.0',author:'Sudhir Kumar (@SudhirDevOps1)',exportedAt:new Date().toISOString(),totalEntries:vault.length,entries:vault};
    await navigator.clipboard.writeText(JSON.stringify(data,null,2));showToast('JSON copied!','success');
}

function importFromFile(event){
    const file=event.target.files[0];if(!file)return;
    const reader=new FileReader();
    reader.onload=e=>{
        document.getElementById('importJSON').value=e.target.result;
        // Check if encrypted
        try{const d=JSON.parse(e.target.result);checkImportEncryption(d);}catch(err){}
        showToast('File loaded!','success');
    };
    reader.readAsText(file);event.target.value='';
}

function checkImportEncryption(data){
    const decryptSection=document.getElementById('importDecryptSection');
    if(data.encrypted===true&&data.salt&&data.iv&&data.data){
        decryptSection.classList.remove('hidden');
    }else{
        decryptSection.classList.add('hidden');
    }
}

// Watch import textarea for encrypted detection
document.addEventListener('DOMContentLoaded',()=>{
    const ta=document.getElementById('importJSON');
    if(ta)ta.addEventListener('input',()=>{
        try{const d=JSON.parse(ta.value);checkImportEncryption(d);}catch(err){document.getElementById('importDecryptSection').classList.add('hidden');}
    });
});

async function importFromText(mode){
    const text=document.getElementById('importJSON').value.trim();
    if(!text){showToast('Paste JSON data first','warning');return;}
    try{
        let data=JSON.parse(text);
        
        // Handle encrypted data
        if(data.encrypted===true&&data.salt&&data.iv&&data.data){
            let decryptKey=document.getElementById('importDecryptKey').value;
            if(!decryptKey){
                // Try session master key
                if(sessionMasterKey)decryptKey=sessionMasterKey;
                else{showToast('Enter the decryption key','warning');return;}
            }
            
            showToast('Decrypting...','warning');
            const result=await decryptData(data,decryptKey);
            if(!result.success){
                showToast('‚ùå '+result.error+' ‚Äî Wrong key?','danger');return;
            }
            data=result.data;
            showToast('üîì Decrypted successfully!','success');
        }
        
        let entries=Array.isArray(data)?data:data.entries&&Array.isArray(data.entries)?data.entries:null;
        if(!entries){showToast('Invalid format','danger');return;}
        const valid=entries.filter(e=>e.site&&e.password);
        if(valid.length===0){showToast('No valid entries','danger');return;}
        valid.forEach(e=>{if(!e.id)e.id=genId();if(!e.createdAt)e.createdAt=new Date().toISOString();if(!e.strength)e.strength=getStrengthLevel(e.password);if(!e.category)e.category='other';if(!e.type)e.type='formula';if(e.favorite===undefined)e.favorite=false;});
        if(mode==='replace')vault=valid;
        else{const ids=new Set(vault.map(e=>e.id));valid.forEach(e=>{if(!ids.has(e.id))vault.push(e);else{e.id=genId();vault.push(e);}});}
        saveVault();updateStats();renderVault();closeModal('modal-ie');
        document.getElementById('importJSON').value='';document.getElementById('importDecryptKey').value='';
        document.getElementById('importDecryptSection').classList.add('hidden');
        showToast(`‚úÖ Imported ${valid.length} entries (${mode})`,'success');
    }catch(err){showToast('Invalid JSON: '+err.message,'danger');}
}

function showInfo(){openModal('modal-info');}
function showShortcuts(){openModal('modal-shortcuts');}

// ===== MODALS =====
function openModal(id){const m=document.getElementById(id);m.classList.remove('hidden');m.classList.add('flex');document.body.style.overflow='hidden';}
function closeModal(id){const m=document.getElementById(id);m.classList.add('hidden');m.classList.remove('flex');document.body.style.overflow='';}

// ===== TOAST =====
function showToast(message,type='success'){
    const container=document.getElementById('toast-container');
    const colors={success:'bg-[--success]/15 border-[--success]/30 text-[--success]',warning:'bg-[--warning]/15 border-[--warning]/30 text-[--warning]',danger:'bg-[--danger]/15 border-[--danger]/30 text-[--danger]'};
    const icons={success:'<svg class="w-4 h-4 shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>',warning:'<svg class="w-4 h-4 shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>',danger:'<svg class="w-4 h-4 shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>'};
    const toast=document.createElement('div');toast.className=`toast ${colors[type]} border rounded-xl px-4 py-3 text-sm flex items-center gap-2 shadow-xl`;
    toast.innerHTML=`${icons[type]} ${escapeHTML(message)}`;container.appendChild(toast);setTimeout(()=>toast.remove(),3000);
}

function escapeHTML(str){if(!str)return'';const d=document.createElement('div');d.textContent=str;return d.innerHTML;}

// ===== KEYBOARD SHORTCUTS =====
document.addEventListener('keydown',e=>{
    if(e.key==='Escape'){['modal-ie','modal-info','modal-view','modal-delete','modal-clearall','modal-history','modal-shortcuts','modal-masterkey'].forEach(closeModal);}
    if(e.altKey){const tabs=['generator','passphrase','random','checker','vault','formula'];const num=parseInt(e.key);if(num>=1&&num<=6){e.preventDefault();switchTab(tabs[num-1]);}}
    if(e.ctrlKey&&e.shiftKey&&e.key==='C'){e.preventDefault();copyPassword();}
    if(e.ctrlKey&&e.shiftKey&&e.key==='G'){e.preventDefault();generateRandom();switchTab('random');}
    if(e.ctrlKey&&e.key==='h'){e.preventDefault();showHistory();}
    if(e.ctrlKey&&e.key==='l'){e.preventDefault();lockVaultAction();}
});
</script>
</body>
</html>
